{% extends 'base.html' %} {% block content %} {% load static %}
 
<style> p {
  margin-top: 0;
  margin-bottom: 0;
}	
@media (min-width: 576px){
.modal-dialog {
    max-width: 1005px;
    margin: 1.75rem auto;
}}
.modal-header {
  padding: .1rem 1rem;
}

.table td, .table th {
    padding: .5rem;
    vertical-align: top;
    border: 1px solid #000;
}
#printdata{
  color: black;
  font-family: auto;
}
</style>
<body>

<div class="container">
	 <div class="row">
		<div class="col-md-12">
			<br>
		<h4 class="text-center">Duty Certificate (M22) Card  Details</h4>
		<br>
		</div>
	</div>
    
        <div class="row">
		
            <div class="col-md-12">
            
            
<table id="datatable" class="table table-striped table-bordered" cellspacing="0" width="100%">
    				<thead>
						 <tr>
							<th>Date</th>
							<th>Shop Section NO</th>
							<th>Work Order NO Of Job Left</th>
							<th>Work Order NO For Time On Duty</th>
							<th>Staff No</th>						
							<th>MONTH</th>
                            <th>Letter No</th>
							<th>Subject /Remarks</th>
							<th>Action</th>
						</tr>
					</thead>
  
					<tbody>
						  <!-- <tr>
							<td>Tiger Nixon</td>
							<td>System Architect</td>
							<td>Edinburgh</td>
							<td>61</td>
							<td>2011/04/25</td>
							<td>$320,800</td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Edit"><button class="btn btn-primary btn-xs" data-title="Edit" data-toggle="modal" data-target="#edit" ><span class="glyphicon glyphicon-pencil"></span></button></p></td>
                            <td><p data-placement="top" data-toggle="tooltip" title="Delete"><button class="btn btn-danger btn-xs" data-title="Delete" data-toggle="modal" data-target="#delete" ><span class="glyphicon glyphicon-trash"></span></button></p></td>
						</tr> -->
{% for i in obj %}
<tr>
<td> {{i.update}} </td>
<td> {{i.shop_sec}} </td>
<td> {{i.wo_no}} </td>
<td> {{i.wo_no1}} </td>
<td> {{i.staff_no}}</td>
<td> {{i.month}} </td>
<td> {{i.letter_no}} </td>
<td> {{i.subject}} </td>
<td> <button  class="btn btn-primary btn-xs"  onclick="getdata('{{i.id}}')"  > view</button>
 </td>
</tr>

 
{% endfor %}    
					</tbody>
				</table>

	
	</div>
	</div>
</div>

<div class="modal" id="edit" tabindex="-1" role="dialog" aria-labelledby="edit" aria-hidden="true">
    <div class="modal-dialog">
    <div class="modal-content">
        <div class="modal-header">        
         <button type="button" class="btn btn-primary" onclick="createPDF()">Print</button>
           <!-- <h5 class="modal-title custom_align" id="Heading">      Duty Certificate (M22) Card Details</h5> -->
           <button type="button" class="close" onclick="popclose()" > <span aria-hidden="true">&times;</span></button>
        </div>
        <div class="modal-body" id='printdata'>
        <div class="row">
          <div class="col-md-2"><p>I.S.O -9002</p> </div>
          <div class="col-md-8"> <h6 class="text-center "><b>INDIAN RAILWAY , DIESEL LOCOMOTIVE WORKS ,VARANASI  </b></h5> </div>
          <div class="col-md-2"><h5 class="text-right"><b>M-22</b></h5  > </div>
        </div>
         
          <div class="row">
         <div class="col-md-3">            
            <p>Letter No: <span id="letterno"></span> </p>
            <p>Staff  No :<span id="staff_no"></span> </p>
           
            <p>Shop Section:<span id="shop_sec"></span> </p>
            <p> Date: <span id="update"></span> </p>
            <p> Month: <span id="month"></span></p>   
             
              
          
        </div>
        <div class="col-md-5   "> 
         
           
             <h6 class="text-center "><b>DUTY CERTIFICATE </b></h5>
              <p>Staff  Name:  <span id="staff_name"></span> ( <span id="design"></span>) </p>
              <p>Date of Leaving Works: <span id="dateleaving"></span></p>
           <p>Work Order NO Of Job Left:<span id="workjobleft"></span></p>
           <p>Work Order NO For Time On Duty: <span id="workduty"></span></p> 
        </div>
        <div class="col-md-4">
          <p >&nbsp;</p>
              <p>Brief Description of Duty: <span id="descduty"></span></p>
             <p>Subject /Remarks: <span id="subject"></span> </p>
           
        </div>
      </div>
        <div class="row">
          <div class="col-md-12">
            <p><b>No.of Hours each date on Duty</b></p>
            </div>

        </div>
          
        <div class="row">
          <div class="col-md-12">
            <table class="table border">
             <tr>
               <th>Date:</th>
               <th>1</th>
               <th>2</th>
               <th>3</th>
               <th>4</th>
               <th>5</th>
               <th>6</th>
               <th>7</th>
               <th>8</th>
               <th>9</th>
               <th>10</th>
               <th>11</th>
               <th>12</th>
               <th>13</th>
               <th>14</th>
               <th>15</th>
               <th>16</th>
              </tr>
              <tr>
                <th>Hours:</th>
                <td><span id="hd1"></span> </td>
                <td><span id="hd2"></span></td>                
                <td><span id="hd3"></span></td>
                <td><span id="hd4"></span> </td>
                <td><span id="hd5"></span> </td>
                <td><span id="hd6"></span> </td>
                <td><span id="hd7"></span></td>
                <td><span id="hd8"></span> </td>
                <td><span id="hd9"></span></td>
                <td><span id="hd10"></span> </td>
                <td><span id="hd11"></span> </td>
                <td><span id="hd12"></span> </td>
                <td><span id="hd13"></span></td>
                <td><span id="hd14"></span></td>
                <td><span id="hd15"></span></td>
                <td><span id="hd16"></span></td>
               </tr>
               <tr>
                <th>Date:</th>
                <th>17</th>
                <th>18</th>
                <th>19</th>
                <th>20</th>
                <th>21</th>
                <th>22</th>
                <th>23</th>
                <th>24</th>
                <th>25</th>
                <th>26</th>
                <th>27</th>
                <th>28</th>
                <th>29</th>
                <th>30</th>
                <th>31</th>
                <td> </td>
               </tr>
               <tr>
                 <th>Hours:</th>
                 <td><span id="hd17"></span> </td>
                 <td> <span id="hd18"></span></td>
                 <td><span id="hd19"></span> </td>
                 <td> <span id="hd20"></span></td>
                 <td><span id="hd21"></span> </td>
                 <td><span id="hd22"></span> </td>
                 <td> <span id="hd23"></span></td>
                 <td><span id="hd24"></span> </td>
                 <td> <span id="hd25"></span></td>
                 <td> <span id="hd26"></span></td>
                 <td><span id="hd27"></span> </td>
                 <td> <span id="hd28"></span></td>
                 <td> <span id="hd29"></span></td>
                 <td> <span id="hd30"></span></td>
                 <td> <span id="hd31"></span></td>
                 <td> </td>
                </tr>
            </table>
            </div>
            </div>
            <div class="row">
              <div class="col-md-6">
                <p>Date of completion of duty :<span id="completionduty"></span></p>
                <p>Date of Return of work:<span id="returnwork"></span> </p>
                <p>-----------------------</p>
                <p>Shop Superintendent</p>
            </div>
<div class="col-md-6 text-right">
  <p>-------------------------------</p>
  <p>Signature & Desination of the<br> official Supervising work on Duty</p>


</div>
</div>

      </div>
        <!-- <div class="modal-footer ">
        <button type="button" class="btn btn-warning btn-lg" style="width: 100%;"><span class="glyphicon glyphicon-ok-sign"></span>Â Update</button>
      </div> -->
        </div>
    <!-- /.modal-content --> 
  </div>
      <!-- /.modal-dialog --> 
    </div>
    
    
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.3.5/jspdf.min.js"></script>  -->
    </body>
    
<script>
	      
  function popclose(){
     
    $('.modal').css("display", "none");
  }
  var month = ['','January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  function getdata(val_id){  
    //alert(val_id)
    $('.modal').css("display", "block");
    let current_datetime = new Date()
        let formatted_date = current_datetime.getDate() + "-" + (current_datetime.getMonth() + 1) + "-" + current_datetime.getFullYear()
        
                  var id=val_id
                   var data = {id};
                    $.ajax({
                        type : 'GET',
                        url : "{% url 'm22getdata' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                          console.log(response);

                            //alert(response.data.update)
                            
                            $('#staff_name').text(response.data.name);
                            $('#design').text(response.data.design);
                            $('#update').text(response.data.update);
                            $('#datecc').text(response.data.datecc);
                            $('#daterw').text(response.data.daterw);                            
                            $('#letterno').text(response.data.letter_no);                          
                            $('#dateleaving').text(response.data.datelw);
                            $('#workjobleft').text(response.data.wo_no);
                            $('#workduty').text(response.data.wo_no1);
                            $('#descduty').text((response.data.briefdd));
                            $('#subject').text(response.data.subject);
                            $('#shop_sec').text(response.data.shop_sec);
                            $('#staff_no').text(response.data.staff_no);
                            $('#month').text(month[response.data.month]);
                            $('#hd1').text(response.data.hd1);
                            $('#hd2').text(response.data.hd2);
                            $('#hd3').text(response.data.hd3);
                            $('#hd4').text(response.data.hd4);
                            $('#hd5').text(response.data.hd5);
                            $('#hd6').text(response.data.hd6);
                            $('#hd7').text(response.data.hd7);
                            $('#hd8').text(response.data.hd8);
                            $('#hd9').text(response.data.hd9);
                            $('#hd10').text(response.data.hd10);
                            $('#hd11').text(response.data.hd11);
                            $('#hd12').text(response.data.hd12);
                            $('#hd13').text(response.data.hd13);
                            $('#hd14').text(response.data.hd14);
                            $('#hd15').text(response.data.hd15);
                            $('#hd16').text(response.data.hd16);
                            $('#hd17').text(response.data.hd17);
                            $('#hd18').text(response.data.hd18);
                            $('#hd19').text(response.data.hd19);
                            $('#hd20').text(response.data.hd20);
                            $('#hd21').text(response.data.hd21);
                            $('#hd22').text(response.data.hd22);
                            $('#hd23').text(response.data.hd23);
                            $('#hd24').text(response.data.hd24);
                            $('#hd25').text(response.data.hd25);
                            $('#hd26').text(response.data.hd26);
                            $('#hd27').text(response.data.hd27);
                            $('#hd28').text(response.data.hd28);
                            $('#hd29').text(response.data.hd29);
                            $('#hd30').text(response.data.hd30);
                            $('#hd31').text(response.data.hd31);
                            $('#completionduty').text(response.data.datecc);
                            $('#returnwork').text(response.data.daterw);
                            

                        }
                          })
                         
                           
               
         }
   
   
     var form = $('#printdata'),  
           cache_width = form.width(), 
           a4 = [595.28, 841.89]; 
    //create pdf  
    function createPDF() {  
      $('modal-body').scrollTop(0)
            // for a4 size paper width and height   
              getCanvas().then(function (canvas) {  
                  var img = canvas.toDataURL("image/png"),  
                   doc = new jsPDF({  
                       unit: 'px',  
                       format: 'a4' ,
                       orientation: 'landscape', 
                   });  
                  doc.addImage(img, 'JPEG', 20, 20);  
                  doc.save('DutyCertificate.pdf');  
                  //form.width(cache_width);  
              });  
          }  
    
          // create canvas object  
          function getCanvas() {  
              //form.width((a4[0] * 1.33333) - 80).css('max-width', 'none');  
              return html2canvas(form, {  
                  imageTimeout: 2000,  
                  removeContainer: true  
              });  
          } 
  
  
  </script>
{% endblock content %}

{% extends 'base.html' %} 
{% block content %}
<!-- <script src="//ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script> -->

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>


<style>
        input[type=text],
        select {
                width: 100%;
                padding: 12px 20px;
                margin: 8px 0;
                display: block;
                border: 1.5px solid rgb(14, 12, 12);
                border-radius: 4px;
                box-sizing: border-box;
        }

        input[type=submit] {
                width: 20%;
                text-align: center;
                background-color: #4CAF50;
                color: rgb(15, 12, 12);
                padding: 14px 20px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=submit]:hover {
                background-color: #45a049;
                text-align: center;
        }

        input[type=button] {
                width: 10%;
                text-align: center;
                background-color: #4CAF50;
                color: white;
                padding: 6px 6px;
                margin: 8px 0;
                border: none;
                border-radius: 4px;
                cursor: pointer;
        }

        input[type=button]:hover {
                background-color: #45a049;
                text-align: center;
        }
</style>
<!-- <h4 style="float: left"><b>D.L.W./VARANASI</b></h4> -->
<h4 align="left"><b>D.L.W./VARANASI</b></h4>
<h4 style="float: right"><b>MG-9</b></h4>
<h4 style="float: left"><b>ISO-9002</b></h4>

<!-- <h4 style="float: right"><b>MG-9</b></h4> -->


<h3 align="center" style="margin-right: 120px"><u><b>COMPLETION </b></u></h3>
<h3 align="center" style="margin-right: 30px" ><u><b>REPORT</b></u></h3>

<h3 align="center" style="margin-right: 49px">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<u><b>INEFFECTIVE M/C. ADVICE</b></u></h3>

<br><br>
<form action="{% url 'mg9compreportviews' %}" method="POST"> {% csrf_token %}
    <div class="container">
        <table class="table">
                        <table class="table">
                                        <tr>
                                         <td>
                                             <label for="sno"><b>Shop Section NO:</b></label>
                                             <select class="form-control" id="shop_sec" name="shop_sec" required>
                                     <option id="op_shop" selected disabled hidden>Select Shop Section</option>
                                     {% if lenm == 1 %}
                                         <option selected readonly>{% for role in roles %}{{role}}{% endfor %}</option>
                                     {% endif %}
                                     {% if lenm > 1 %}
                                     {% for role in roles %}
                                       <option>{{role}}</option>
                                     {% endfor %}
                                     {% endif %}
                                 </select>
                                         </td>
                                         <td>
                                             <label for="mw_no"><b>MW No:</b></label>
                                             <select class="form-control" id="mwno" name="mwno" required>
                                 <option id="op_mw" selected disabled hidden>Select MW No</option>
                                 {% if lenm == 1 %}
                                 {% for i in wono %}
                                   <option>{{i.lcno}}</option>
                                 {% endfor %}
                                 {% endif %}
                             </select>
                                         </td>
                                         <td>
                                                 <label for="staff_no"><b>STAFF NO:</b></label>
                                                 <select class="form-control" id="staffno" name="staffno" required>
                                         <option id="op_staff" selected disabled hidden>Select Staff NO</option>
                                         {% if lenm == 1 %}
                                         {% for i in staff %}
                                           <option>{{i.staff_no}}</option>
                                         {% endfor %}
                                         {% endif %}
                                           </select>
                                             </td>
                                            
                                         </tr>
                                    
                             </table>
                               
                             <center><input type="submit" value="Proceed" id="myproceed" name="proceed"  hidden/></center>
                         </div>
                         <input type="hidden" name="sub" id="sub" value={{sub}} >
                         <br><br> {% if sub == 1 %}
                         <div id="print" style="align:center" >
                         <input type="hidden" name="len" value="{{len}}">
                         <input type="hidden" name="len2" id="len2" value="{{len2}}">
                             
                             <br><br>
           
            <br><br>
            <table border="5" align="left" style="margin-left: 450px">
        
                    <tr>
                        <th><h5><b>SEC:</b></th>
                        <td>
                                        {% if len %}
                                        {% for i in obj %}
                                        
                                        <input type="text" id="shop_sec" name="shop_sec" class="myinp" value="{{i.sec}}"  readonly/>{% endfor %}
                                        {% else %}
                                        <input  type="text" name="shop_sec" value="{{shop_sec}}" readonly/>
                                        {% endif %}
                             </td>
                            </h5>
                        
                    </tr>
                   
                    <tr>
                            <th><h5><b>M.W. No.:</b></th>
                       
                        <td>
                                        {% if len %}
                                        {% for i in obj %}
                                        
                                        <input type="text" id="mw_no" name="mw_no" class="myinp" value="{{i.mw_no}}"  readonly />{% endfor %}
                                        {% else %}
                                        <input  type="text" name="mw_no" value="{{mw_no}}" readonly />
                                        {% endif %}
                            </td>
                          </h5>
                      </tr>

                </table>
                <table border="5" align="right" style="margin-right: 450px">
        
                        <tr>
                            <th><h5><b>SL NO:</b></th>
                            <td>
                                        {% if len2 %}
                                        {% for i in obj2 %}
                                        
                                        <input type="text" id="sl_no" name="sl_no" class="myinp" value="{{i.sl_no}}" aria-readonly="true"  readonly>{% endfor %}
                                        {% else %}
                                        <input type="text" id="sl_no" name="sl_no" class="myinp" value="0" aria-readonly="true"  readonly>
                                        {% endif %}
                                 </td>
                                </h5>
                            
                        </tr>
                       
                        <tr>
                                <th><h5><b>STAFF No.:</b></th>
                           
                            <td>
                                        {% if len %}
                                        {% for i in obj %}
                                        
                                        <input type="text" id="staff_no" name="staff_no" class="myinp" value="{{i.staff_no}}"  readonly/>{% endfor %}
                                        {% else %}
                                        <input  type="text" name="staff_no" value="{{staff_no}}" readonly/>
                                        {% endif %}                 
                                               </td>
                            </h5>
                          </tr>
    
                        </table>
                        <br><br><br><br><br><br.<br><br><br><br>
                        <h5 border="5"><b>COMPLAINT:</b>
                                {% if len2 %}
                                {% for i in obj2 %}
                                
                                <input type="text" id="complaint" name="complaint" class="myinp" value="{{i.complaint}}" required/>{% endfor %}
                                {% else %}
                                <input  type="text" name="complaint" value="{{complaint}}" required/>
                                {% endif %}
                                </h5>
<br><Br><br>

    <table border="5" align="center" style="width: 100%;">
        
            <tr colspan="6" >
                <th></th>
                <th ><h5><b>HANDED OVER:</b></h5></th>
                <th ><h5><b>COMPLETED:</b></h5></th>
                <th colspan="3"><h5><b>CAUSE & HOURS:</b></h5></th>                
            </tr>
           
            <tr aria-rowspan="3" >
                <td>
                    <h5><b>DATE:</b></h5>
                </td>
                <td>
                                {% if len2 %}
                                {% for i in obj2 %}
                                
                                <input type="text" id="datepicker" name="date_handed" class="myinp" value="{{i.handed_date}}" required  />{% endfor %}
                                {% else %}
                                <input  type="text" name="date_handed" id="datepicker" required />
                                <input type="text" name="cyear"  id="cyear" value="{{cyear}}" hidden>
                                {% endif %}  

                </td>
                <td>
                                {% if len %}
                                {% for i in obj %}
                                
                                <input type="text" id="datepicker1" name="date_com" class="myinp" value="{{i.comp_date}}" required />{% endfor %}
                                {% else %}
                                <input  type="text" name="date_com" id="datepicker1" required/>
                                <input type="text" name="cyear"  id="cyear" value="{{cyear}}" hidden>

                                {% endif %}

                </td>
                <td colspan="3">
                                {% if len %}
                                {% for i in obj %}
                                
                                <input type="text" id="cause_hrs" name="cause_hrs" class="myinp" value="{{i.cause_hrs}}" required/>{% endfor %}
                               
                                {% else %}
                                <!-- <select class="form-control" name="cause_hrs" id="cause_hrs" required> -->
                                       <input type="checkbox" name="elec" id="elec" value="ELEC" onchange="myFunction()" >ELEC
                                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                       <input type="checkbox" name="mech" value="MECH" id="mech" onchange="myFunction2()">MECH
                                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                       <input type="checkbox" name="mech_ele" value="MECH&ELE" id="mech_ele" onchange="myFunction4()" >MECH & ELE
                                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                       <input type="checkbox" name="mp" id="mp" value="MP"  onchange="myFunction1()" >MP
                                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                       <input type="checkbox" name="inv"  id="inv" value="INV"  onchange="myFunction3()">INV
                                       &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

                                       <input type="checkbox" name="mismp" value="MISMP" id="mismp" onchange="myFunction5()" >MISMP


                                       
                                         
                                {% endif %} 
                </td>

                 
              </tr>
              <tr aria-rowspan="2">
                    <td>
                        <h5><b>TIME:</b></h5>
                    </td>
                    <td>
                                {% if len2 %}
                                {% for i in obj2 %}
                                
                                <input type="time" id="time_handed" name="time_handed" class="myinp" value="{{i.handed_time}}"  onchange="SumHours();" required/>{% endfor %}
                                {% else %}
                                <input  type="time" name="time_handed" id="time_handed" onchange="SumHours();" required/>
                                {% endif %}
            
                    </td>
                    <td>
                                {% if len %}
                                {% for i in obj %}
                                
                                <input type="time" id="time_com" name="time_com" class="myinp" value="{{i.comp_time}}" onchange="SumHours();" required/>{% endfor %}
                                {% else %} 
                                <input  type="time" name="time_com" id="time_com"  onchange="SumHours();"  required/>
                                {% endif %}    
                    </td>
                    <!-- <td colspan="3">
                      <h5><b>TIME(MP/INV/MISMP):</b></h5>
                      {% if len %}
                      {% for i in obj %}
                      
                      <input type="text" id="time_hrs" name="time_hrs" class="myinp" value="{{i.time_hrs}}"  required/>{% endfor %}
                      {% else %}
                      <input type="time" name="time_hrs" id="time_hrs"  style="width: 40%;" required>
                      {% endif %}
                       </td> -->
                    <td>
                      <h5><b>MP</b></h5>
                      {% if len %}
                      {% for i in obj %}
                      <input type="text" id="mp_time" name="mp_time" class="myinp" value="{{i.mp_time}}"  required/>{% endfor %}
                      {% else %} 
                      <input type="time" id="mp_time" name="mp_time" required>
                      {% endif %}
                    </td>
                    <td>
                        <h5><b>INV</b></h5>
                        {% if len %}
                        {% for i in obj %}
                        <input type="text" id="inv_time" name="inv_time" class="myinp" value="{{i.inv_time}}"  required/>{% endfor %}
                        {% else %} 
                        <input type="time" id="inv_time" name="inv_time" required>
                        {% endif %}
                      </td>
                      <td>
                          <h5><b>MISMP</b></h5>
                          {% if len %}
                          {% for i in obj %}
                          <input type="text" id="mismp_time" name="mismp_time" class="myinp" value="{{i.mismp_time}}"  required/>{% endfor %}
                          {% else %} 
                          <input type="time" id="mismp_time" name="mismp_time" required>
                          {% endif %}
                        </td>   
                       
                  </tr>
                  <tr>
                        <td >
                            <h5><b>CM-SEC:</b></h5>
                        </td>
                        <td >
                                        {% if len2 %}
                                        {% for i in obj2 %}
                                        
                                        <input type="text" id="sec_handed" name="sec_handed" class="myinp" value="{{i.handed_cmsec}}" required/>{% endfor %}
                                        {% else %}
                                        <input  type="text" name="sec_handed" id="sec_handed" required />
                                        {% endif %}        
                        </td>
                        <td >
                                        {% if len %}
                                        {% for i in obj %}
                                        
                                        <input type="text" id="sec_com" name="sec_com" class="myinp" value="{{i.comp_cmsec}}" required/>{% endfor %}
                                        {% else %}
                                        <input  type="text" name="sec_com" id="sec_com" required/>
                                        {% endif %}        
                        </td>
        
                           <td  >
                                <h5><b>TOTAL LOST HRS:</b></h5>
                                <!-- <input type="text" id="action" name="action"> -->

                           </td>
                           <td colspan="2">
                                
                            {% if len %}
                            {% for i in obj %}
                            
                            <input type="text" id="lost_hrs" name="lost_hrs" class="myinp" value="{{i.total_losthrs}}" required/>{% endfor %}
                            {% else %}
                            <input type="text" id="lost_hrs" name="lost_hrs" value="{{lost_hrs}}" required readonly>
                            {% endif %}
                           </td>
                        

                           
                      </tr>
                      <tr >
                            <td rowspan="2" >
                                <h5><b>CM-SERV:</b></h5>
                            </td>
                            <td rowspan="2" >
                                        {% if len2 %}
                                        {% for i in obj2 %}
                                        
                                        <input type="text" id="serv_handed" name="serv_handed" class="myinp" value="{{i.handed_cmserv}}" required/>{% endfor %}
                                        {% else %}
                                        <input  type="text" name="serv_handed" id="serv_handed" required />
                                        {% endif %}            
                            </td >
                            <td rowspan="2" >
                                        {% if len %}
                                        {% for i in obj %}
                                        
                                        <input type="text" id="serv_com" name="serv_com" class="myinp" value="{{i.comp_cmserv}}" required/>{% endfor %}
                                        {% else %}
                                        <input  type="text" name="serv_com" id="serv_com" required/>
                                        {% endif %}            
                            </td>
                            <td colspan="3">
                                    <h5><b>ACTION:</b></h5>
                                    {% if len %}
                                {% for i in obj %}
                                
                                <input type="text" id="action" name="action" class="myinp" value="{{i.action}}" required/>{% endfor %}
                               
                                {% else %}
                                <select class="form-control" type=text name="action" id="action" required >
                                        <option value="PMS">PMS</option>
                                        <option value="EMS">EMS</option>
                                        <option value="EMS">TR</option>

                                         </select>
                                {% endif %}  
                               </td>
                               <tr>
                                   <td>
                                     <h5><b>PMS</b></h5>
                                    
                                   </td>
                                   <td>
                                        <h5><b>EMS</b></h5>
                                       
                                      </td>
                                      <td>
                                            <h5><b>TR</b></h5>
                                           
                                          </td>

                               </tr>
            
                               <!-- <td >
                                    <h5><b>PMS</b></h5>
                                    
    
                               </td>
                               <td >
                                    <h5><b>EMS</b></h5>
                                    
    
                               </td>
                               <td >
                                    <h5><b>TR</b></h5>
                                    
    
                               </td> -->
                               
                          </tr>
        
    

            </table>
            <center>
            <h5><b>TO BE FILLED BY SECTION CH/MAN</b></h5>
            </center>
        </div>
        <br><br>
        <center>
          <input type="submit" name="proceed" value="submit" style="height:50px; width:100px">
          <input type="button" onclick="printDiv()" value="print" style="height:50px; width:100px">
         
  </center>
        {% endif %}

            <br><br><br><br><br><br.<br><br><br><br>
            <script>
            function SumHours() {
              var smon = document.getElementById('time_handed').value ;
              var fmon = document.getElementById('time_com').value ;
              // var hand_date=document.getElementById('handed_date');
              // var comp_date=document.getElementById('comp_date');
              // var t=hand_date.split('/')
              // console.log(t[0],t[1],t[2])
              var diff = 0 ;
              if (smon && fmon) {
                smon = ConvertToSeconds(smon);
                fmon = ConvertToSeconds(fmon);
                diff = Math.abs( fmon - smon ) ;
                total_hrs=secondsTohhmmss(diff);
                $('#lost_hrs').val(secondsTohhmmss(diff));
                console.log(lost_hrs)
                console.log( 'time difference is : ' + secondsTohhmmss(diff) );
              }
            
              function ConvertToSeconds(time) {
                var splitTime = time.split(":");
                return splitTime[0] * 3600 + splitTime[1] * 60;
              }
            
              function secondsTohhmmss(secs) {
                var hours = parseInt(secs / 3600);
                var seconds = parseInt(secs % 3600);
                var minutes = parseInt(seconds / 60) ;
                return hours + ":" + minutes ;
              }
            }
            </script>
 <script>
                        document.querySelector("#shop_sec").addEventListener('change',(e)=>{
             //console.log("hi");
                             e.preventDefault();
                             var shop_sec = $("#shop_sec").val()
                             var data = {shop_sec};
                               $.ajax({
                                 type : 'GET',
                                 url : "{% url 'mg9getmwno' %}",
                                 dataType : 'json',
                                 data : data,
                                 success : function(response){
                                   
                                   var elementsadded = document.querySelectorAll(".newelemwno1");
                                       if(elementsadded.length>0){
                                           var elementsaddedarr = Array.from(elementsadded);
                                           elementsaddedarr.forEach((el)=> el.remove());
                                           document.querySelector("#op_mwno").selected=true;
                                            
                                        }
                                       var brarr,mystr,html;
                                       brarr = response.map((el)=>el.lcno);
                                       mystr = "";
                                       brarr.forEach((el,index)=>{
                                         html = `<option class="newelemwno1">${brarr[index]}</option>`
                                         mystr = html.concat(mystr);
                                       });
                                       html = "";
                                       document.querySelector("#mwno").insertAdjacentHTML('beforeend',mystr);
                                       mystr=""; 
                                 }
                                   })
                         })
                         $("#mwno").change(function(e){
              e.preventDefault();
              var mwno = $(this).val();
              var shop_sec = $("#shop_sec").val();
              var data = {mwno,shop_sec};
                $.ajax({
                  type : 'GET',
                  url : "{% url 'mg9getstaffno' %}",
                  dataType : 'json',
                  data : data,
                  success : function(response){
                        var elementsadded = document.querySelectorAll(".newelestaff");
                        if(elementsadded.length>0){
                          var elementsaddedarr = Array.from(elementsadded);
                        elementsaddedarr.forEach((el)=> el.remove());
                        document.querySelector("#op_staff").selected = true;
                       
                        }
                        var brarr,mystr,html;
                        brarr = response.map((el)=>el.staff_no);
                        mystr = "";
                        brarr.forEach((el,index)=>{
                          html = `<option class="newelecdno">${brarr[index]}</option>`
                          mystr = html.concat(mystr);
                        });
                        html = "";
                        document.querySelector("#staffno").insertAdjacentHTML('beforeend',mystr);
                        mystr="";
                  }
                     })
                     }) 

 
              
        
        
                         document.querySelector("#staffno").addEventListener('change',(e)=>{

                        
                          
        document.querySelector("#myproceed").click();
     


        })
        document.addEventListener('keypress',(event)=>{
        if(event.keyCode===13){
            event.preventDefault();
        }
        })


        function myFunction() {
  // var x = document.getElementById("elec").value;
  if ( document.getElementById("elec").checked==true ) {
        document.getElementById("inv_time").disabled = true;
        document.getElementById("mismp_time").disabled = true; 
    } else {
      document.getElementById("inv_time").disabled = false; 
      document.getElementById("mismp_time").disabled = false; 

    }
    }

    function myFunction1() {
  // var x = document.getElementById("elec").value;
  if ( document.getElementById("mp").checked==true ) {
        document.getElementById("inv_time").disabled = true;
        document.getElementById("mismp_time").disabled = true; 
    } else {
      document.getElementById("inv_time").disabled = false; 
      document.getElementById("mismp_time").disabled = false; 

    }
    }

    function myFunction2() {
  // var x = document.getElementById("mech").value;
  if ( document.getElementById("mech").checked==true ) {
        document.getElementById("mp_time").disabled = true;
        document.getElementById("mismp_time").disabled = true; 
    } else {
      document.getElementById("mp_time").disabled = false; 
      document.getElementById("mismp_time").disabled = false; 

    }
    }

    function myFunction3() {
  // var x = document.getElementById("mech").value;
  if ( document.getElementById("inv").checked==true ) {
        document.getElementById("mp_time").disabled = true;
        document.getElementById("mismp_time").disabled = true; 
    } else {
      document.getElementById("mp-time").disabled = false; 
      document.getElementById("mismp_time").disabled = false; 

    }
}

function myFunction4() {
  // var x = document.getElementById("mech").value;
  if ( document.getElementById("mech_ele").checked==true ) {
        document.getElementById("mp_time").disabled = true;
        document.getElementById("inv_time").disabled = true; 
    } else {
      document.getElementById("mp-time").disabled = false; 
      document.getElementById("inv_time").disabled = false; 


}
}
function myFunction3() {
  // var x = document.getElementById("mech").value;
  if ( document.getElementById("mismp").checked==true ) {
        document.getElementById("mp_time").disabled = true;
        document.getElementById("inv_time").disabled = true; 
    } else {
      document.getElementById("mp-time").disabled = false; 
      document.getElementById("inv_time").disabled = false; 

    }
}
         
        
        function printDiv() {
             var printContents = document.getElementById("print").innerHTML;
        
               var style = "<style>";
                style = style + "table {width: 100%;font: 17px Calibri;}";
                style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
                style = style + "padding: 2px 3px;text-align: left;}";
                style = style + "</style>";
              var win = window.open('', '', 'height=500,width=500');
        
                
                win.document.write('<html><head>');
        
                win.document.write('<title>MG9 Complete Report</title>');
                win.document.write(style);
                win.document.write('</head>');
                win.document.write('<body>');
                win.document.write(printContents);
                win.document.write('</body></html>');
               
        
        
                win.print();
                win.close();
        
        } 

        var a=document.getElementById('cyear');
        var b=a-b;  
        $(function() {
        $( "#datepicker" ).datepicker({  maxDate: new Date(),
        changeYear: true,
        yearRange: (a)+':'+(b),
        });
        });

        $(function() {
        $( "#datepicker1" ).datepicker({  maxDate: new Date(),
        changeYear: true,
        yearRange: (a)+':'+(b),
        });
        });


   
                        </script> 
                       
           
               

{% endblock %}            
           
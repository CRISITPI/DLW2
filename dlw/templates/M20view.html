{% extends 'base.html' %} {% block content %}

<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>
<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

  <script>
    $(document).ready(function () { $('#datepicker').datepicker({dateFormat: 'yy-mm-dd'}); });
  </script>
  <script>
    $(document).ready(function () { $('#datepicker1').datepicker({dateFormat: 'yy-mm-dd'}); });
  </script>

<style>
table, td, th {  
  text-align: left;
}
table {
  border-collapse: collapse;
  width: 50%;
}
th, td {
  padding: 15px;
}
</style>
<style>
    input[type=text],
    select {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: block;
        border: 0.5px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    input[type=submit] {
        width: 20%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=submit]:hover {
        background-color: #45a049;
        text-align: center;
    }
    
    input[type=button] {
        width: 10%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=button]:hover {
        background-color: #45a049;
        text-align: center;
    }
</style>
<h3 align="center">कर्मशाला कर्मचारियों की रविवार की बुकिंग </h3>
<h4 align="center">SUNDAY BOOKING OF WORKSHOP STAFF</h4>
<div> <h6 align="left" style="margin-left: 100px;">आई.एस.ओ. - 9002/ I.S.O. - 9002 </h6> </div>
<div> <h6 align="left" style="margin-left: 100px;">डी० रे० का (वाराणासी )/ D.L.W. (Varanasi)</h6> <h6 align="right" style="margin-right: 100px;">एम-20/M.-20 </h6></div><br>
<form>
    <div class="container">
<table class="table">
  <tr>
      <center>
          {% if messages %}
          <ul class="messages">
              {% for message in messages %}
              <font size="3">
                  <li>
                      {{ message }}
                  </li>
              </font>
              {% endfor %}
          </ul>
          {% endif %}
  </center>
  </tr>
    <tr>

        <td>
            <label for="sno"><b>Date/ दिनांक.:</b></label>            
          <input type="text" id="datepicker" style="width: 150px;" name="datepicker"  placeholder="dd-mm-yyyy" readonly/>
        </td> 

        <td>
            <label for="sno"><b>Shop Section NO/शॉप अधी.:</b></label>
          <select class="form-control ll" id="shop_sec" name="shop_sec" required style="width: 150px;">   
          <option id="op_shop" selected disabled hidden>Shop Section</option>  
          {% if lenm == 1 %}
            {% for role in roles %}
              <option selected readonly>{{role}}</option>
                {% endfor %}
                {% endif %}
                {% if lenm > 1 %}
                  {% for role in roles %}
                    <option>{{role}}</option>
                  {% endfor %}
                {% endif %}
            </select>
          </td>   

          <td>
              <label for="sno"><b>Staff No/ स्टाफ न .:</b></label>
              <select class="form-control ll" id="staff_no" name="staff_no" required style="width: 150px;">       
                  <option id="staff_no" selected disabled hidden>Staff Number</option>    
            </select>
          </td>        
        </tr>
    </table>
    
    <hr style="width:90%; margin-right: 100px; margin-left: 100px;" align="center">

  
    <h6 align="center">Particulars of Staff booked to work on Sunday</h6>
    <h6 align="center">रविवार को काम करने के लिए बुक किये गए कर्मचारियों  का विवरण </h6>
   <div class="row">
  <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
    <table class="table">
      <thead>
        <tr>
          <th>Name नाम</th>
          <th>Ticket No.  टिकट स.</th>            
        </tr>
      </thead>
      <tbody id="projectData">    
      </tbody> 
    </table>
  </div>
  <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
    <table class="table">
      <thead>
        <tr>
          <th>Date of leave to be given बदले में दी जाने वाली छुट्टी की तारीख </th>          
        </tr>
      </thead>
      <tbody >  
          <tr><td><input type="text" id="datepicker1" style="width: 150px;" name="datepicker1"  placeholder="dd-mm-yyyy" readonly/></td></tr>
      </tbody> 

    </table>
  </div>
</div>
</div>
</form>  
<script type="text/javaScript">
  document.querySelector("#shop_sec").addEventListener('change',(e)=>{
    //console.log("hi");
                    e.preventDefault();
                    var shop_sec = $("#shop_sec").val()
                    var data = {shop_sec};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'm20getstaffno' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                         // console.log(response);
                          var elementsadded = document.querySelectorAll(".newelewono");
                              if(elementsadded.length>0){
                                  var elementsaddedarr = Array.from(elementsadded);
                                  elementsaddedarr.forEach((el)=> el.remove());
                                  document.querySelector("#staff_no").selected=true;
                                  
                                }
                              var brarr,mystr,html;
                              brarr = response.map((el)=>el.staff_no);
                              mystr = "";
                              brarr.forEach((el,index)=>{
                                html = `<option class="newelewono">${brarr[index]}</option>`
                                mystr = html.concat(mystr);
                              });
                              html = "";
                              document.querySelector("#staff_no").insertAdjacentHTML('beforeend',mystr);
                              mystr=""; 
                        }
                          })
                })


      document.querySelector("#staff_no").addEventListener('change',(e)=>{
    //console.log("hi");
                    e.preventDefault();
                    var staff_no = $("#staff_no").val()
                    var data = {staff_no};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'm20getstaffName' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                          console.log(response);
                          var elementsadded = document.querySelectorAll(".newelewono");
                              if(elementsadded.length>0){
                                  var elementsaddedarr = Array.from(elementsadded);
                                  elementsaddedarr.forEach((el)=> el.remove());
                                  document.querySelector("#staff_no").selected=true;                                  
                                }

                                   var i=0, totdata; 
                                 for(i;i<response.length;i++){

                                      mstaff_no = response[i].staff_no
                                      name      = response[i].name                                     

                                      totdata = '<tr><td>'+name+'</td><td>'+mstaff_no+'</td></tr>'
                                      $(totdata).appendTo('#projectData');
                                  }


                              var brarr,mystr,html;
                              brarr = response.map((el)=>el.staff_no);
                              mystr = "";
                              brarr.forEach((el,index)=>{
                                html = `<option class="newelewono">${brarr[index]}</option>`
                                mystr = html.concat(mystr);
                              });
                              html = "";
                              document.querySelector("#staff_no").insertAdjacentHTML('beforeend',mystr);
                              mystr=""; 
                        }
                          })
                })


</script>    
{% endblock content %}
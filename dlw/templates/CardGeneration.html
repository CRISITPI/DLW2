{% extends 'base.html' %}

{% block content %}
<br>
<h3><center>Card Generation</center></h3>
<center>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <font size="3">
            <li>
                {{ message }}
            </li>
        </font>
        {% endfor %}
    </ul>
    {% endif %}
</center>
<br>
<center>
    <form method="POST">{%csrf_token%}
    <div class="container">    
            
        <div class="form-row">            
            <div class="form-group col-md-4">
                <label for="inputZip">Select Card to generate</label>
                <select class="form-control" name="cardno" id="cardno" required>
                    <option selected disabled hidden>Select Card</option>
                    <option>M2</option>
                    <option>M4</option>
                    <option>M5</option>
                    <option>M15</option>
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="inputState">Assembly No.</label>
                <select class="form-control" name="asslyno" id="asslyno" required>
                    <option id="asslyno_op" selected disabled hidden>Select Assembly No.</option>
                        {% for i in assmno %}
                            <option values='{{i.part_no}}'>{{i.part_no}}</option>
                    {% endfor %}    
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="inputCity">Batch Order No.</label>
               
                 <select class="form-control" id="batchno" name="batchno" required>
                              <option id="op_batchno" selected disabled hidden>Select Batch NO</option>
                              {% if lenm == 1 %}
                              {% for i in bo_no_temp %}
                                <option>{{i.bo_no}}</option>
                              {% endfor %}
                              {% endif %}
                     </select>
            </div>
        </div> 
        <br><center><button type="submit" name="cardbutton" value="Generate Cards" class="btn btn-primary">Generate Cards</button></center>
    </div>   
    
    </form>
</center>

<script>
document.querySelector("#asslyno").addEventListener('change',(e)=>{
                    e.preventDefault();
                    var mAsslyno = $("#asslyno").val();                    
                    var data = {mAsslyno};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'm27getBatchNo' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                          var elementsadded = document.querySelectorAll(".newelepart1");
                              if(elementsadded.length>0){
                                  var elementsaddedarr = Array.from(elementsadded);
                                  elementsaddedarr.forEach((el)=> el.remove());       
                                  document.querySelector("#op_batchno").selected=true;  
                                 
                               }
                              var brarr,mystr,html;
                              brarr = response.map((el)=>el.bo_no); 
                              mystr = "";
                              brarr.forEach((el,index)=>{
                                html = `<option class="newelepart1">${brarr[index]}</option>`
                                mystr = html.concat(mystr);
                              });
                              html = "";
                              document.querySelector("#batchno").insertAdjacentHTML('beforeend',mystr);
                              mystr=""; 
                        }
                   })
                })
</script>

{% endblock content %}

{% extends 'base.html' %}

{% block content %}
<style>
  .progress {
      position: relative;
      height: 2px;
      display: block;
      width: 100%;
      background-color: white;
      border-radius: 2px;
      background-clip: padding-box;
      /*margin: 0.5rem 0 1rem 0;*/
      overflow: hidden;

    }
    .progress .indeterminate {
background-color:black; }
    .progress .indeterminate:before {
      content: '';
      position: absolute;
      background-color: #2C67B1;
      top: 0;
      left: 0;
      bottom: 0;
      will-change: left, right;
      -webkit-animation: indeterminate 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite;
              animation: indeterminate 2.1s cubic-bezier(0.65, 0.815, 0.735, 0.395) infinite; }
    .progress .indeterminate:after {
      content: '';
      position: absolute;
      background-color: #2C67B1;
      top: 0;
      left: 0;
      bottom: 0;
      will-change: left, right;
      -webkit-animation: indeterminate-short 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) infinite;
              animation: indeterminate-short 2.1s cubic-bezier(0.165, 0.84, 0.44, 1) infinite;
      -webkit-animation-delay: 1.15s;
              animation-delay: 1.15s; }

    @-webkit-keyframes indeterminate {
      0% {
        left: -35%;
        right: 100%; }
      60% {
        left: 100%;
        right: -90%; }
      100% {
        left: 100%;
        right: -90%; } }
    @keyframes indeterminate {
      0% {
        left: -35%;
        right: 100%; }
      60% {
        left: 100%;
        right: -90%; }
      100% {
        left: 100%;
        right: -90%; } }
    @-webkit-keyframes indeterminate-short {
      0% {
        left: -200%;
        right: 100%; }
      60% {
        left: 107%;
        right: -8%; }
      100% {
        left: 107%;
        right: -8%; } }
    @keyframes indeterminate-short {
      0% {
        left: -200%;
        right: 100%; }
      60% {
        left: 107%;
        right: -8%; }
      100% {
        left: 107%;
        right: -8%; } }
</style>
<br>
<h3><center>Card Generation</center></h3>
<center>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <font size="3">
            <li>
                {{ message }}
            </li>
        </font>
        {% endfor %}
    </ul>
    {% endif %}
</center>
<br>
<center>
    <form method="POST">{%csrf_token%}
    <div class="container">    
            
        <div class="form-row">            
            <div class="form-group col-md-4">
                <label for="inputZip">Select Card to generate</label>
                <select class="form-control" name="cardno" id="cardno" required>
                    <option selected disabled hidden>Select Card</option>
                    <option>M2</option>
                    <option>M4</option>
                    <option>M5</option>
                    <option>M15</option>
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="inputState">Assembly No.</label>
                <select class="form-control" name="asslyno" id="asslyno" required>
                    <option id="asslyno_op" selected disabled hidden>Select Assembly No.</option>
                        {% for i in assmno %}
                            <option values='{{i.part_no}}'>{{i.part_no}}</option>
                    {% endfor %}    
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="inputCity">Batch Order No.</label>
               
                 <select class="form-control" id="batchno" name="batchno" required>
                              <option id="op_batchno" selected disabled hidden>Select Batch NO</option>
                              {% if lenm == 1 %}
                              {% for i in bo_no_temp %}
                                <option>{{i.bo_no}}</option>
                              {% endfor %}
                              {% endif %}
                     </select>
            </div>
        </div> 
        <br><center><button type="submit" name="cardbutton" value="Generate Cards" class="btn btn-primary">Generate Cards</button></center>
    </div> 
    <body><div class="progress" id="PreLoaderBar">
        <div class="indeterminate"></div>
    </div></body>  
    
    </form>
</center>

<script>
document.querySelector("#asslyno").addEventListener('change',(e)=>{
                    e.preventDefault();
                    var mAsslyno = $("#asslyno").val();                    
                    var data = {mAsslyno};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'm27getBatchNo' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                          var elementsadded = document.querySelectorAll(".newelepart1");
                              if(elementsadded.length>0){
                                  var elementsaddedarr = Array.from(elementsadded);
                                  elementsaddedarr.forEach((el)=> el.remove());       
                                  document.querySelector("#op_batchno").selected=true;  
                                 
                               }
                              var brarr,mystr,html;
                              brarr = response.map((el)=>el.bo_no); 
                              mystr = "";
                              brarr.forEach((el,index)=>{
                                html = `<option class="newelepart1">${brarr[index]}</option>`
                                mystr = html.concat(mystr);
                              });
                              html = "";
                              document.querySelector("#batchno").insertAdjacentHTML('beforeend',mystr);
                              mystr=""; 
                        }
                   })
                })


                document.onreadystatechange = function () {
            if (document.readyState === "complete") {
                console.log(document.readyState);
                document.getElementById("PreLoaderBar").style.display = "none";
            }
        }

  
</script>

{% endblock content %}

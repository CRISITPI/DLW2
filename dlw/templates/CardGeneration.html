{% extends 'base.html' %}

{% block content %}
{% load static %}
<style>
</style>
<br>
<h3><center>Card Generation</center></h3>
<center>
    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
        <font size="3">
            <li>
                {{ message }}
            </li>
        </font>
        {% endfor %}
    </ul>
    {% endif %}
</center>
<br>
<center>
    <form method="POST">{%csrf_token%}
    <div class="container" id="div1">    
            
        <div class="form-row">            
            <div class="form-group col-md-4">
                <label for="cardno">Select Card to generate</label>
                <select class="form-control" name="cardno" id="cardno" required>
                    <option selected disabled hidden>Select Card</option>
                    <option value="M2">M2</option>
                    <option value="M4">M4</option>
                    <option value="M5">M5</option>
                    <option value="M15">M15</option>
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="asslyno">Assembly No.</label>
                <select class="form-control" name="asslyno" id="asslyno" required>
                    <option id="asslyno_op" selected disabled hidden>Select Assembly No.</option>
                        {% for i in assmno %}
                            <option values='{{i.part_no}}'>{{i.part_no}}</option>
                    {% endfor %}    
                </select>
            </div>
            <div class="form-group col-md-4">
                <label for="batchno">Batch Order No.</label>
                 <select class="form-control" id="batchno" name="batchno" required>
                              <option id="op_batchno" selected disabled hidden>Select Batch NO</option>
                              {% if lenm == 1 %}
                              {% for i in bo_no_temp %}
                                <option>{{i.bo_no}}</option>
                              {% endfor %}
                              {% endif %}
                     </select>
            </div>
        </div> 
        <div class="form-group col-md-4">
            <label for="brn_no">BRN NO  :   </label>
            <input type="text" id="brn_no" name="brn_no" value=""  maxlength="6" onchange="myFunc1();" onkeypress="return isNumberKey(event)"> 
        </div>
        <div class="form-row" id="alt">
            
            <div class="form-group col-md-4">
                <label for="isalt">Is Alternate  :   </label>
                <input type="radio" id="ralt" name="ralt" value="T" onchange="only1();" > True
                <input type="radio" id="ralt" name="ralt" value="F" onchange="only1();" > False
            </div>
        </div>
        <br><center><button type="submit" name="cardbutton" value="Generate Cards" class="btn btn-primary" onclick="wait()">Generate Cards</button></center>
    </div> 
    <div id="div2">
        <center><img src="{% static 'dlw/images/loading.gif' %}" style="width:20%;height:20%;"></center>
    </div>
   
    </form>
</center>

<script>

function myFunc1(){
    var brn_no = $("#brn_no").val();
    if(brn_no.length < '6'){
        //document.getElementById('brn_no').focus();
        $("#brn_no").focus();
        alert("BRN NO must be 6 character.")
    }
}

function isNumberKey(evt) {

var charCode = (evt.which) ? evt.which : evt.keyCode;
if (charCode > 31 && (charCode < 48 || charCode > 57)) return false;
return true;

}

window.onload=function()
{
    $('#div1').show();
    $('#div2').hide();
    $('#alt').hide();
}

document.querySelector("#asslyno").addEventListener('change',(e)=>{
                    e.preventDefault();
                    var mAsslyno = $("#asslyno").val();                    
                    var data = {mAsslyno};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'm27getBatchNo' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                          var elementsadded = document.querySelectorAll(".newelepart1");
                              if(elementsadded.length>0){
                                  var elementsaddedarr = Array.from(elementsadded);
                                  elementsaddedarr.forEach((el)=> el.remove());       
                                  document.querySelector("#op_batchno").selected=true;  
                                 
                               }
                              var brarr,mystr,html;
                              brarr = response.map((el)=>el.bo_no); 
                              mystr = "";
                              brarr.forEach((el,index)=>{
                                html = `<option class="newelepart1">${brarr[index]}</option>`
                                mystr = html.concat(mystr);
                              });
                              html = "";
                              document.querySelector("#batchno").insertAdjacentHTML('beforeend',mystr);
                              mystr=""; 
                        }
                   })
                });

function wait()
{
    $('#div1').hide();
    $('#div2').show();
}
document.querySelector("#cardno").addEventListener('change',(e)=>{
                    e.preventDefault();
                   
                    var d=$('#cardno option:selected').val();
                    if(d=='M4' || d=='M5')
                    {$('#alt').show();}
                    
});
  
</script>

{% endblock content %}

{% extends 'base.html' %} {% block content %}
 
<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" /> -->
 
 
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>
{% comment %} <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> {% endcomment %}
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
{% comment %} <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> {% endcomment %}
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
 
  <script>
    $(document).ready(function () { $('#updt_date').datepicker({dateFormat: 'dd-mm-yy'}); });
  </script>
   <script>
      $(document).ready(function () { $('#acc_date').datepicker({dateFormat: 'dd-mm-yy'}); });
    </script>

    <script>
        $(document).ready(function () { $('#exam_date').datepicker({dateFormat: 'dd-mm-yy'}); });
      </script>
 



      <meta name="viewport" content="width=device-width, initial-scale=1">
      
<style>

      /* Style the tab */
      .tab {
        overflow: hidden;
        border: 1px solid #ccc;
        background-color: #f1f1f1;
        width:120%;
      }
      
      /* Style the buttons inside the tab */
      .tab button {
        background-color: inherit;
        float: left;
        border: none;
        outline: none;
        cursor: pointer;
        padding: 14px 16px;
        transition: 0.3s;
        font-size: 17px;
      }
      
      /* Change background color of buttons on hover */
      .tab button:hover {
        background-color: #ddd;
      }
      
      /* Create an active/current tablink class */
      .tab button.active {
        background-color: #ccc;
      }
      
      /* Style the tab content */
      .tabcontent {
        display: none;
        padding: 6px 12px;
        border: 1px solid #ccc;
        border-top: none;
        
      }

  
table, td, th {  
  text-align: left;
}
table {
  border-collapse: collapse;
  width: 50%;
}
th, td {
  padding: 15px;
}
</style>
<style>
    input[type=text],
    select {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: block;
        border: 0.5px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    input[type=submit] {
        width: 10%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=submit]:hover {
        background-color: #45a049;
        text-align: center;
    }
    
    #add {
        width: 30%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    #master {
      width: 200px;
      text-align: center;
      background-color: #4CAF50;
      color: white;
      padding: 6px 6px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
  }


 
    #print {
        width: 10%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    #head{

      background-color:slategrey;
      width: 120%;
      color: white;
    }
    
    input[type=button]:hover {
        background-color: #45a049;
        text-align: center;
    }
 
    .container input:checked ~ .checkmark:after {
                display: inline;
              }
              #customers {
                font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
                border-collapse: collapse;
                margin-left: auto;
                margin-right: auto;
                width: 120%;
                
            }
            
            #customers td,
            #customers th {
                border: 1px solid #ddd;
                padding: 8px;
            }
            
            #customers tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            #customers td{
              background-color: slategrey;
              width: 120%;

            }
            
            /* #customers tr:hover {
                background-color: #ddd;
            } */
            
            #customers th {
                padding-top: 12px;
                padding-bottom: 12px;
                text-align: left;
                background-color:olivedrab;
                color: white;
            }
</style>
<form action="{% url 'MG33view' %}" method="POST"> {% csrf_token %}
<div  class="container">
    <table id="head" class="table">
      <tr>
      <center>
          {% if messages %}
          <ul class="messages">
              {% for message in messages %}
              <font size="3">
                  <li>
                      {{ message }}
                  </li>
              </font>
              {% endfor %}
          </ul>
          {% endif %}
  </center>
  </tr>
  <br>
    <tr>
            <h3 align="center">डीजल रेल इंजन कारखाना  - MG33 </h4>
    <h4 align="center">शिल्प परीक्षा वृत - Trade Test</h4>
 
 
<div> <h6 align="left" style="margin-left: 100px;">आई.एस.ओ. - 9002/ I.S.O. - 9002 </h6> </div>
<div> <h6 align="left" style="margin-left: 100px;">डी० रे० का (वाराणासी )/ D.L.W. (Varanasi)</h6> <h6 align="right" style="margin-right: 100px;">एम. जी. - 33/ M. G. - 33 </h6></div><br>
 
<!-- 
<div class="tab">
    <button class="tablinks" onclick="openCity(event, 'Home')">Home</button>
    <button class="tablinks" href="/examdetail">Master Data</button>
    <button class="tablinks" onclick="openCity(event, 'ViewReport')">View Report</button>
  </div>
  <div id="Home" class="tabcontent"> -->
        <td>
            <label for="sno"><b>Date/ दिनांक </b></label>            
          <input type="text" id="updt_date" style="width: 150px;" name="updt_date" value="{{lvdate}}" placeholder="yyyy-mm-dd" readonly required/>
        </td> 
 
        <td>
            <label for="sno"><b>Shop Section NO/ शॉप अधी..:</b></label>
          <select class="form-control ll" id="shop_sec" name="shop_sec" required style="width: 150px;" required>   
          <option id="op_shop" selected disabled hidden>Shop Section</option>  
         
          {% if lenm == 1 %}
            {% for role in roles %}
              <option selected readonly>{{role}}</option>
                {% endfor %}
                {% endif %}
                {% if lenm > 1 %}
                  {% for role in roles %}
                    <option>{{role}}</option>
                  {% endfor %}
                {% endif %}
            </select>
          </td>  


          <td>
              <a class="btn btn-primary" id="master" href="/view_exam_data">View Data</a>
              

          </td>
          <td>
              <a class="btn btn-primary" id="master" href="/examdetail">Trade Test Master Screen</a>
              

          </td>


       

          <script>
            function redirect(){
              document.getElementById("master")
              document.redirect("mg33Master.html");

            }
          </script>
        
          <!-- <td>
              <label for="sno"><b>Staff No/ ????? ? .:</b></label>
              <select class="form-control ll" id="staff_no" name="staff_no" required style="width: 150px;">       
                  <option id="staff_no" selected disabled hidden>Staff Number</option>    
            </select>
          </td>   -->
          <td><input type="text" id="stffno" name="stffno" value="{{ticketno}}" style="display: none" /></td>     
          <td><input type="text" id="shpsec" value="{{shopsec}}" style="display: none" /></td>     
        </tr>
        <tr>
          <td><input type="submit" name="proceed" value="Add" id="proceed" style="display: none" /></td>
        </tr>
    </table>
    <input type="hidden" id="sub" name="sub" value={{sub}}>
  
  {% if sub == 1 %}

<table id="head">

  
  <th><b>Place Of Exam</b></th>
  <th><b>Subordinate Supervisor-अधीनस्थ पर्यवेक्षक </b></th>
  <th><b>Exam Code</b></th>
  <th><b>Exam Type</b></th>
  <th><b>Date of Exam/ परीक्षा की तिथि</b></th>
  <th><b>Practical Exam Desc</b></th>
  <th><b>Oral Exam Desc</b></th>

  <tr>

      <td>
         
          <select class="form-control ll" name="place" style="width: 150px;" required>
            <option>DLW</option>
            <option>Other</option>
            <option>Other</option>
            
          </select>  
        </td>  
        
        <td>
            

          <select class="form-control ll" id="shop_sec" name="sec_sup" style="width: 150px;" required>
          <option id="op_shop" name="sec_sup" value="{{lj}}" selected disabled hidden>Section Supervisor</option> 
          
              {% for lj in empname %}
              <option value="{{lj}}">{{lj}}</option>
              {% endfor %}
          </select>
          
         </td>

         <td>
           
            <select class="form-control ll" id="exam_code" name="exam_code" style="width: 150px;" onchange="exam_detail(this)" required>
                <option id="exam_code" name="exam_code" selected disabled hidden>Exam Code</option> 
          
              {% for ex in examcode %}
              <option value="{{ex}}">{{ex}}</option>
              {% endfor %}

                <!-- Ajax function to get exam data from data base  -->


              <script>
                function exam_detail(th){


                  var id = th.id;
                  var two=document.getElementById(id).value;
                 
                  var data = {two};
                                      $.ajax({
                                        type : 'GET',
                                        url : "{% url 'mg33getexam' %}",
                                        dataType : 'json',
                                        data : data,
                                        success : function(response){
                                            console.log(response);
                                         document.getElementById('exam_type').value= response.exam.exam_type;
                                         document.getElementById('exam_date').value= response.exam.exam_date;
                                         document.getElementById('prac_exam').value= response.exam.prac_exam;
                                         document.getElementById('oral_exam').value= response.exam.oral_exam;
                
                                        }
                                          })

                }

              </script>
                
              </select>
         </td>
         <td>
           
            <input id="exam_type" type="text" name="exam_type" style="width: 150px;" placeholder="Exam Type" required>
         </td>
         
            <td>
                  
                <input type="text" id="exam_date" style="width: 150px;" name="exam_date" placeholder="yyyy-mm-dd" readonly required/>
              </td> 
           <td>
            <input id="prac_exam" type="text" name="prac_exam" style="width: 150px;" placeholder="Prac Exam" required>
         </td>
         <td>
           
            <input id="oral_exam" type="text" name="oral_exam" style="width: 150px;" placeholder="Oral Exam" required>
         </td>


  </tr>

</table>
 
  <datalist id="names">
                {% for lc in names %}
                <option value="{{lc}}"></option>
                {% endfor %}
            </datalist>
 
  <datalist id="empname">
      {% for lj in empname %}
      <option value="{{lj}}"></option>
      {% endfor %}
  </datalist>
    <input type="button" id="add" value="Add Exam Info Worker Wise" />
    
    <input type="hidden" name="num" value="THE OUTPUT OF PRODUCT FUNCTION" id="myvalue" />
    <input type="hidden" name="totindb" value={{totindb}} id="totindb">
 
  <div id="printdata">
        <h3 align="center"></h3>
    
    
   <div class="row">
  <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
    <!-- <table class="table">
      <thead>
          <input type="text" name="empname" value="{{empname}}" style="display: none" />
        <tr>
          <th>Name ???</th> 
          
          <th>Ticket No.  ???? ?.</th>       
        </tr>
        <tr>
          <td>{{empname}}</td>
          <td>{{ticketno}}</td> 
        </tr>
    
      </thead>
      <tbody id="projectData">
          
      </tbody> 
    </table>
  </div>
  <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
    <table class="table">
      <thead>
        <tr>
          <th>Date of leave to be given ???? ??? ?? ???? ???? ?????? ?? ????? </th>          
        </tr>
      </thead>  
     
      <tbody >  
          <tr><td><input type="text" id="alt_date" style="width: 150px;" name="alt_date"  placeholder="yy-mm-dd" value="{{alt_date}}" readonly required /></td></tr>
      </tbody> 
 
    </table> -->
  </div> 
</div>
<input type="hidden" name="totmebs" id="totmebs" value="0">
<!-- {% if totindb %}
{% for key, values in dictemper.items %}
<table>
<tr><th>Name नाम</th><th>Application Number प्रमेदक न. </th><th>Date of Exam परीक्षा की तिथि   </th></tr>
<tr>
 <td>{{values.name}}</td>
  <td>{{values.ticketno}}</td>
  <td><input type="text" id="lv_date" style="width: 150px;" name="lv_date" value="{{values.acdate}}" placeholder="yyyy-mm-dd" readonly required/></td>

</tr>
</table>
 {% endfor %}     
{% endif %} -->


<!-- <td>

    <label for="skill" name="skill">Skilled/ Un-Skilled/ Core</label>
    <select class="form-control ll" name="skill" style="width: 150px;" required>
      <option>Skilled</option>
      <option>Un-Skilled</option>
      <option>Core</option>
     
    </select>


</td> -->
<div id="items"> </div>

 
<br><br>
<div class="container" style="width: 150%;" id="exam_info">
        
          <table id="head">
            <tr>
     
          </tr>
        </table>
         
  
         <table id = "head" style="width: 100%;">
           <tr>
             <td>
                <label for="sno"><b>Trade Test Officer</b></label>
 
              <select class="form-control ll" id="shop_sec" name="trade_test_officer" required style="width: 200px;" required>
              <option id="op_shop" name="sec_sup" value="{{lc}}" selected disabled hidden>Trade Test Officer</option> 
              
                  {% for lj in empname %}
                  <option value="{{lj}}">{{lj}}</option>
                  {% endfor %}
              </select>
              
             </td>
 
             <td>
 
                <label  for="sno"><b>Foreman/ Trade Test</b></label>
 
                <select class="form-control ll" id="shop_sec" name="foreman" style="width: 210px;" required>
                <option id="op_shop" name="Mistry" selected disabled hidden>Foreman/ Trade Test</option> 
                {% for lc in names %}
                  <option value="{{lc}}">{{lc}}</option>
                  {% endfor %}
                  </select>
 
             </td>

             <td>

                <label  for="trade_test_admin"><b>Trade Test Admin</b></label>
                <select class="form-control ll" id="ssfo" name="trade_test_admin" style="width: 250px;" required>
                    
                      <option  id="op_shop" name="trade_test_admin" selected style="width: 250px; float:right;" >शिल्प परीक्षा नायिका</option> 
                      {% for lc in empname %}
                        <option value="{{lc}}">{{lc}}</option>
                        {% endfor %}
                        </select><br>

                </td>

              </tr>

            </table>

      </div> 

<center>
  <input id="submit" type="submit" name="proceed" value="Save" id="submitted"> 
  <input id="print" type="button" onclick="printDiv()" value="Print"> 
</center>
</div>
{% endif %}
</div>
</div>
</form>



<!-- <div id="ViewReport" class="tabcontent">
      <h3>Test Report</h3>
      <p>View Test Report</p>
</div> -->

<!-- 
<script>
    function openCity(evt, cityName) {
      var i, tabcontent, tablinks;
      tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
      }
      tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
      }
      document.getElementById(cityName).style.display = "block";
      evt.currentTarget.className += " active";
    }
    </script> -->






 
<script type="text/javaScript">
$(document).ready(function () { $('#acc_date').datepicker({dateFormat: 'yy-mm-dd'}); });
 
$( function() {
              $( ".datepicker2" ).datepicker({
                dateFormat:'yy-mm-dd',
                changeMonth:true,
                changeYear:true,
                yearRange:"2009:2099"
              }).val;
            } );
 
$( document ).ready(function() {
    var shop_sec=document.getElementById('shpsec').value;
    var sub=document.getElementById('sub').value;
    var tt=0;
    if (sub == 1)
    {
    var totindb=document.getElementById('totindb').value;
 
      $("#shop_sec").val(shop_sec);
      console.log("shop_sec",shop_sec);
      //if(totindb)
      //{
      //for(tt=1;tt<=totindb;tt++)
      //{
       // console.log(document.getElementById('datehid'+String(tt)).value);
       // $('#datedb'+String(tt)).datepicker({dateFormat: 'yy-mm-dd'});
       // $('#datedb'+String(tt)).datepicker('setDate', document.getElementById('datehid'+String(tt)).value);
      
        
       
     // }
     // }
    }
 
});
  var j=0;
  var prac="prac";
  var oral="oral";
  var total="total";
  var remk="remk";
  
 
  $("#add").click(function(e) {
    event.preventDefault()
        console.log("j"+String(j));
        j++;
        
      
 
        var nameoname="name"+String(j);
        var ticketfname="ticket"+String(j);
        var skillname="skill"+String(j);
        prac="prac"+String(j);
        oral="oral"+String(j);
        total="total"+String(j);
        remk="remk"+String(j);
        console.log(prac);
        
       
        var sno=j;
        var totindb=document.getElementById('totindb').value;
      
        if(j==1 && totindb == 0)
        {
            var happ='<div><table id="head">'+'<tr><th style="width: 220px;">  Worker Name नाम</th><th style="width: 200px; float:right;">Staff Number स्टाफ न </th>'+'<th style="width: 180px;float:centre;">Skill</th><th style="width: 170px;float:centre;">Practical Score</th><th style="width: 160px;float:left;">Oral Score</th><th style="width: 150px;float:left;">Total Score</th><th style="width:100px;">Remark</th>';
 
    happ=happ+'</tr></table></div>';
        $('#items').append(happ);
 
        }
        var htAppend='<div><table id="customers"><tr>'+'<td><select name='+nameoname+' id='+nameoname+' onchange="find(this);" class="form-control ll" style="width: 220px;" required ><option  value="">name</option></select></td>'+'<td><input type="text" id="'+ticketfname+'" name="'+ticketfname+'" style="width: 170px;" readonly></td>'+
          '<td><select class="form-control ll" id='+skillname+' style="width: 170px;" name='+skillname+' style="width: 160px;" required><option value="Skilled">Skilled</option><option value="Un-Skilled">Un-Skilled</option><option value="Un-Skilled">Core</option></select></td>'+
          '<td><input type="text" id="'+prac+'" style="width: 150px;" name="'+prac+'" ></td><td><input type="text" id="'+oral+'" style="width: 150px;" name="'+oral+'" onblur="javascript:addNumbers()" ></td><td><input type="text" id="'+total+'" style="width: 150px;" name="'+total+'" ></td>'+
          '<td><input type="text" id="'+remk+'" style="width: 150px;" name="'+remk+'" readonly></td>';
 
     htAppend=htAppend+'</tr></table>'+'</div>';
     $('#items').append(htAppend);
     document.getElementById("totmebs").value=j;
     var x=document.getElementById("names");
     var pp=0;
     for (pp = 0; pp < x.options.length; pp++) {
      
     $("#"+nameoname).append("<option value='"+x.options[pp].value+"'>"+x.options[pp].value+"</option>");
     }
 
});



    function addNumbers()
    {
            console.log(prac,oral);
            //var total= parseInt(document.getElementById(total).value);
            var val1 = parseInt(document.getElementById(prac).value);
            var val2 = parseInt(document.getElementById(oral).value);
            var temp=val1+val2;
            if (val1>60 || val2 >40){
              alert("Please enter valid score for practical and oral score ");              
            }

       
            else{
              var ansD = document.getElementById(total);
              ansD.value = val1 + val2;
            
            if (temp>=55)
            {
              document.getElementById(remk).value="PASS";
            }
            else
            {
              document.getElementById(remk).value="FAIL";
            }
          }
            
    }


   



 
function find(th)
{
  var id = th.id;
  var two=id.split("name");
  var ticket="ticket"+two[1];
  var name=document.getElementById(id).value;
  var shop_sec=document.getElementById('shpsec').value;
 
 
 
  var data = {shop_sec,name};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'mg33getstaffno' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                            console.log(response);
                         document.getElementById(ticket).value= response.cont.wono;

                        }
                          })
 
 
}
                document.querySelector("#shop_sec").addEventListener('change',(e)=>{
 
                  document.querySelector("#proceed").click();
              })
      
    function printDiv() {
      var printContents = document.getElementById("printdata").innerHTML;
 
        var style = "<style>";
         style = style + "table {width: 100%;font: 17px Calibri;}";
         style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
         style = style + "padding: 2px 3px;text-align: left;}";
         style = style + "</style>";
       var win = window.open('', '', 'height=500,width=500');
 
         win.document.write('<html><head>');
 
         win.document.write('<title>Trade Test - DLW</title>');
         win.document.write(style);
         win.document.write('</head>');
         win.document.write('<body>');
         win.document.write(printContents);
         win.document.write('</body></html>');
 
         win.print();
         win.close();
 
 
 }

</script>    
{% endblock content %}
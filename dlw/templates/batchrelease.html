{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
    * {
      box-sizing: border-box;
    }
    
    body {
      font: 16px Arial;  
    }
   
    .autocomplete {
      position: relative;
      display: inline-block;
    }
    
    input {
      padding: 10px;
      font-size: 16px;
    }
    
    input[type=text] {
      background-color: white;
      width: 100%;
    }
    
    input[type=submit] {
      background-color: DodgerBlue;
      color: #fff;
      cursor: pointer;
    }
    input[type=button] {
      background-color: DodgerBlue;
      color: #fff;
      cursor: pointer;
      width: 20%;
        text-align: center;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
  

    table tr{
      cursor: pointer;transition: all .25s ease-in-out;
  }
  .autocomplete-items {
      position: absolute;
      border: 1px solid #d4d4d4;
      border-bottom: none;
      border-top: none;
      z-index: 99;
      top: 100%;
      left: 0;
      right: 0;
      max-height: 400px;
      overflow-y: scroll; 
      overflow-x: hidden;
    } 
    
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      background-color: #fff; 
      border-bottom: 1px solid #d4d4d4; 
    } 
    
   .autocomplete-items div:hover {
      background-color: #e9e9e9; 
    } 
    
    .autocomplete-active {
      background-color: DodgerBlue; 
      color: #ffffff; 
    }
    .vertical-center {
      margin: 0;
      position: absolute;
      -ms-transform: translateY(-50%);
      transform: translateY(-50%);
    }
    </style>
<br>
<h3><center>BATCH RELEASE</center></h3>
<center>
    {% if messages %}
    {% for message in messages %}
    {% if message.level == DEFAULT_MESSAGE_LEVELS.INFO%}
    <div class="alert alert-primary" id="msg" role="alert">{{ message }}</div>
    {%endif%}
    {% if message.level == DEFAULT_MESSAGE_LEVELS.SUCCESS%}
    <div class="alert alert-success" id="msg" role="alert">{{ message }}</div>
    {%endif%}
    {% if message.level == DEFAULT_MESSAGE_LEVELS.ERROR%}
    <div class="alert alert-danger" id="msg" role="alert">{{ message }}</div>
    {%endif%}
    {% if message.level == DEFAULT_MESSAGE_LEVELS.WARNING%}
    <div class="alert alert-warning" id="msg" role="alert">{{ message }}</div>
    {%endif%}
    {% endfor %}
    {% endif %}
</center>
<br>
<br>
<br>
<br>
<center>
    <form method="POST">{%csrf_token%}
    <div class="container"> 
      <div class="container1">
        <div class="form-row">            
            <div class="form-group col-md-3">
                <label for="batchno">BATCH NO</label>
                <div class="autocomplete" style="width:250px;">
                    <input id="batchno" autocomplete="off" type="text" name="batchno" placeholder="ENTER BATCH NO"    maxlength="8" onkeypress="return isNumberKeybatch(event)" >
                    <br><span id="lblErrorbatch" style="color: red"></span> 
                </div></div>
            <div class="form-group col-md-3">
                <label for="asslyno">ASSEMBLY NO</label>
                  <div class="autocomplete" style="width:250px;">
                        <input id="asslyno" autocomplete="off" type="text" name="asslyno" placeholder="ENTER ASSEMBLY NO"  maxlength="8" onkeypress="return isNumberKeyassly(event)" >
                        <br><span id="lblErrorassly" style="color: red"></span> 
                    </div></div>
                    <div class="form-group col-md-3">
                      <label for="brn">BRN NO &nbsp;&nbsp; &nbsp;&nbsp;  </label>
                       <div class="autocomplete" style="width:250px;">
                          <input id="brn" autocomplete="off" type="text" name="brn" placeholder="ENTER BRN NO" maxlength="5" onkeypress="return isNumberKeybrn(event)">
                          <br><span id="lblErrorbrn" style="color: red"></span> 
                      </div></div>
            <div class="form-group col-md-3">
                <label for="date">RELEASE DATE &nbsp;&nbsp; &nbsp;&nbsp;  </label>
                 <div class="autocomplete" style="width:250px;">
                    <input id="date" autocomplete="off" type="text" name="date" placeholder="SELECT DATE" >
                  </div>
                </div></div>
                <br>
                <br>
                <div >
                <input type="button" name="releasebatch1" id="releasebatch1" value="Release Batch" class="btn btn-primary" onclick="checkdetails()"></button>
                <input type="submit" name="releasebatch" id="releasebatch" value="Release Batch" class="btn btn-primary" hidden></button>
                <input type="button" name="viewbatch" id="viewbatch" value="View Batch" class="btn btn-primary"></button>
                <!-- <input type="submit" name="releasebatch" id="releasebatch" value="Release Batch" class="btn btn-primary" onclick="wait()"></button> -->
              </div>


</div>

</form>
</center>

<script>
setTimeout(function(){
        if ($('#msg').length > 0){
            $('#msg').remove(); 
        }
    },5000)

    function checkdetails() 
    {
      batch=$('#batchno').val();
      assly=$('#asslyno').val();
      brn=$('#brn').val();
      if(batch.length==0)
        alert('Enter Batch no.!!!');
      else
      if(batch.length<8)
        alert("Batch No. Should be 8 Character!!!");
      else
      if(assly.length==0)
        alert('Enter Assembly No.!!! ');
      else
      if(assly.length<8)
        alert('Assembly No. should be 8 Character!!!');
      else
      if(brn.length==0)
        alert('Enter Brn No.!!!');
      else
      if(brn.length<5)
        alert('Brn No. Should be 5 Character!!!');
      else
      if($('#date').val().length==0)
        alert('Select Date!!!');
      else
        alert('Under development!!!');
      

    }
    function isNumberKeybatch(evt) {
    var lblErrora = document.getElementById("lblErrorbatch");
        lblErrora.innerHTML = "";
var charCode = (evt.which) ? evt.which : evt.keyCode;
if (charCode > 31 && (charCode < 48 || charCode > 57))
{
    lblErrora.innerHTML = "Only Numbers allowed.";
    return false;
} 
return true;
}
function isNumberKeyassly(evt) {
    var lblErrora = document.getElementById("lblErrorassly");
        lblErrora.innerHTML = "";
var charCode = (evt.which) ? evt.which : evt.keyCode;
if (charCode > 31 && (charCode < 48 || charCode > 57))
{
    lblErrora.innerHTML = "Only Numbers allowed.";
    return false;
} 
return true;
}
function isNumberKeybrn(evt) {
    var lblErrora = document.getElementById("lblErrorbrn");
        lblErrora.innerHTML = "";
var charCode = (evt.which) ? evt.which : evt.keyCode;
if (charCode > 31 && (charCode < 48 || charCode > 57))
{
    lblErrora.innerHTML = "Only Numbers allowed.";
    return false;
} 
return true;
}
var batchac=[' '];
var asslyac=[' '];
var brnac=[' '];
$(document).ready(function()
{
  $('#date').datepicker({dateFormat:'dd-mm-yy',
                      beforeShow: function(){    
                      $(".ui-datepicker").css('font-size', 14.8) 
                      }
                      });
                      var data = {};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'batchreleasegetbatch' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                            for(i=0;i<response.length;i++)
                           {
                             batchac.push((response[i].batchordno).toString());
                           }
                          }

  });
                      });
document.querySelector("#asslyno").addEventListener('click',(e)=>{
                    e.preventDefault();
                    if($('#batchno').val().length==0)
                    {
                      alert('Enter Batch no.!!!');
                      $('#batchno').focus();
                    }
                    else
                    if($('#batchno').val().length<8)
                    {
                      alert("Batch No. Should be 8 Character!!!");
                      $('#batchno').focus();
                    }
                    var batch = $("#batchno").val();
                                   
                    var data = {mAsslyno};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'Batchreleasedetails' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){
                            for(i=0;i<response.length;i++)
                           {
                             countries1.push((response[i].bo_no).toString());
                           }

                           }
                     })
                });

document.querySelector("#brn").addEventListener('click',(e)=>{
                    e.preventDefault();
                    if($('#batchno').val().length==0)
                    {
                      alert('Enter Batch no.!!!');
                      $('#batchno').focus();
                    }
                    else
                    if($('#batchno').val().length<8)
                    {
                      alert("Batch No. Should be 8 Character!!!");
                      $('#batchno').focus();
                    }
                    else
                    if($('#asslyno').val().length==0)
                    {
                      alert('Enter Assembly no.!!!');
                      $('#asslyno').focus();
                    }
                    else
                    if($('#asslyno').val().length<8)
                    {
                      alert("Asslembly No. Should be 8 Character!!!");
                      $('#asslyno').focus();
                    }

                  });

  // document.querySelector("#date").addEventListener('click',(e)=>{
  //                   e.preventDefault();
  //                   if($('#batchno').val().length==0)
  //                   {
  //                     alert('Enter Batch no.!!!');
  //                     $('#batchno').focus();
  //                   }
  //                   else
  //                   if($('#batchno').val().length<8)
  //                   {
  //                     alert("Batch No. Should be 8 Character!!!");
  //                     $('#batchno').focus();
  //                   }
  //                   else
  //                   if($('#asslyno').val().length==0)
  //                   {
  //                     alert('Enter Assembly no.!!!');
  //                     $('#asslyno').focus();
  //                   }
  //                   else
  //                   if($('#asslyno').val().length<8)
  //                   {
  //                     alert("Asslembly No. Should be 8 Character!!!");
  //                     $('#asslyno').focus();
  //                   }
  //                   else
  //                   if($('#brn').val().length==0)
  //                   {
  //                     alert('Enter Brn no.!!!');
  //                     $('#brn').focus();
  //                   }
  //                   else
  //                   if($('#brn').val().length<5)
  //                   {
  //                     alert("Brn No. Should be 5 Character!!!");
  //                     $('#brn').focus();
  //                   }
                    

                    
  //                 });

  function autocomplete(inp, arr) {
      var currentFocus;
      inp.addEventListener("input", function(e) {
          var a, b, i, val = this.value;
          closeAllLists();
          if (!val) { return false;}
          currentFocus = -1;
          a = document.createElement("DIV");
          a.setAttribute("id", this.id + "autocomplete-list");
          a.setAttribute("class", "autocomplete-items");
          this.parentNode.appendChild(a);
          for (i = 0; i < arr.length; i++) {
            if (arr[i].substr(0, val.length).toUpperCase() == val.toUpperCase()) {
              b = document.createElement("DIV");
              b.innerHTML = "<strong>" + arr[i].substr(0, val.length) + "</strong>";
              b.innerHTML += arr[i].substr(val.length);
              b.innerHTML += "<input type='hidden' value='" + arr[i] + "'>";
              b.addEventListener("click", function(e) {
                  inp.value = this.getElementsByTagName("input")[0].value;
                 
                  closeAllLists();
              });
              a.appendChild(b);
            }
          }
      });
     
      inp.addEventListener("keydown", function(e) {
          var x = document.getElementById(this.id + "autocomplete-list");
          if (x) x = x.getElementsByTagName("div");
          if (e.keyCode == 40) {
            currentFocus++;
            addActive(x);
          } else if (e.keyCode == 38) { 
            currentFocus--;
            addActive(x);
          } else if (e.keyCode == 13) {
            e.preventDefault();
            if (currentFocus > -1) {
              if (x) x[currentFocus].click();
            }
          }
      });
      function addActive(x) {
        if (!x) return false;
        removeActive(x);
        if (currentFocus >= x.length) currentFocus = 0;
        if (currentFocus < 0) currentFocus = (x.length - 1);
        x[currentFocus].classList.add("autocomplete-active");
      }
      function removeActive(x) {
        for (var i = 0; i < x.length; i++) {
          x[i].classList.remove("autocomplete-active");
        }
      }
      function closeAllLists(elmnt) {
    
        var x = document.getElementsByClassName("autocomplete-items");
        for (var i = 0; i < x.length; i++) {
          if (elmnt != x[i] && elmnt != inp) {
            x[i].parentNode.removeChild(x[i]);
          }
        }
      }
      document.addEventListener("click", function (e) {
          closeAllLists(e.target);
      });
    }
    autocomplete(document.getElementById("batchno"), batchac);
</script>


{% endblock content %}

{% extends 'base.html' %} {% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>

<style>
    input[type=text],
    select {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: block;
        border: 0.5px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    input[type=submit] {
        width: 20%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=submit]:hover {
        background-color: #45a049;
        text-align: center;
    }
    
    input[type=button] {
        width: 20%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=button]:hover {
        background-color: #45a049;
        text-align: center;
    }
</style>
<br>
<br>
<h3 align="center">M9<br>Authority Slip</h3>
<br>
<center>
  {% if messages %}
  <ul class="messages">
      {% for message in messages %}
      <font size="3">
          <li>
              {{message}}
          </li>
      </font>
      {% endfor %}
  </ul>
  {% endif %}
</center>
<br>
<form action="{% url 'm9view' %}" method="POST"> {%csrf_token%}
    <div class="container">
        <table class="table">
            <tr>
                <td>
                    <label for="sno"><b>SHOP SECTION NO/शॉप अधी. :</b></label>
                  

                    <select class="form-control" id="shop_sec" name="shop_sec" required>
            <option id="op_shop" selected disabled hidden>Select Shop Section</option>
            {% if lenm == 1 %}
                <option selected readonly>{% for role in roles %}{{role}}{% endfor %}</option>
                {{role}}
            {% endif %}
            {% if lenm > 1 %}
            {% for role in roles %}
            {{role}}
              <option>{{role}}</option>
            {% endfor %}
            {% endif %}
        </select>
                </td>
               
                <td>
                    <label for="partno"><b>PART NO:/पार्ट सं.:</b></label>
                    <select class="form-control" id="part_nop" name="part_nop" required>
            <option id="op_part" selected disabled hidden>Select Part No</option>
        </select>
                </td>
                <td>
                  <label for="opno"><b></b>OPERATION NO.:</b></label>
                  <select class="form-control" id="op_no" name="op_no" required>
                <option id="op_opno" selected disabled hidden>Select operation No</option>
        </select>
                </td>
                <td>
                  <label for="wk_ord_no"><b>WORK ORDER NO:/कार्यादेश सं. :</b></label>
                  <select class="form-control" id="wo_no" name="wo_no" required>
                   <option id="op_wo" selected disabled hidden>Select Work Order NO</option>
                      
                  </select>
              </td>
            </tr>
        </table>

        <input type="submit" value="Proceed" name="proceed" id="myproceed" hidden/>


    </div>
 <br><br> 
{% if sub == 1 %}
<div id="print" style="align:center" >
<input type="hidden" name="len" value="{{len}}">
<input type="hidden" name="shopsec" value="{{shop_sec}}"/>
<input type="hidden" name="partno" value="{{part_no}}"/>
<input type="hidden" name="wono" value="{{wo_no}}"/>
<input type="hidden" name="opnno" value="{{op_no}}"/>

<h5 style="float: left"><b>DLW</b><br><b>VARANASI</b></h5>
<center><h4><u><B>AUTHORITY SLIP</B></u></h4></center>


<br>
<h5 style="float: right"><b>SEC  </b>{{shop_sec}} <br><b>DATE-</b><input type="TEXTBOX" name="ddate" value="{{date}}" readonly></h5>
<h5><b>IDLE TIME CARD </b><input type="radio" name="itc" value="man">MAN</input> <input type="radio" name="itc" value="mac">MACHINE </input> </h5>
<h5><b>TIME CARD </b><input type="radio" name="ittime" value="on">ON</input> <input type="radio" name="ittime" value="off">OFF </input></h5>




<br>
<br>


<table border="2" align="center" width="100%">
<tr>
<th><h5><b>CHANGE OPTR</b> </h5></th>
<th><h5><b>SUSPENDED JOB CARD.:</b> </h5></th>
<th><h5><b>RESUME JOB CARD</b></h5></th>
<th  ><h5><b>AFFECTED C&D NO.: </b></b></h5></th>
<th  ><h5><b>CAT OF IDLE TIME: </b></b></h5></th>
<th  ><h5><b>AFFECTED OPRN NO.: </b></b></h5></th>

</tr>


<tr>
<td ><input type="text" name ="cngoptr" required></td>
<td ><input type="text" name ="sbc" required></td>
<td ><input type="text" name ="rjc" required></td>
<td>{{part_no}}</td>
<td ><input type="text" name ="cit" required></td>
<td>{{op_no}}</td>
</tr>





<tr>
<th  ><h5><b>M.W.NO: </b></b></h5></th>
<td><h5><b>AFFECTED W.O.NO </b></h5></td>
<td><h5><b>MG9 NO. </b></h5></td>
<td><h5><b>OPTER NO.</b></h5></td>
<td><h5><b>PREVIOUS OPTR. NO </b></h5> </td>
<td><h5><b>REMARKS</b></h5></td>


</tr>
<tr>
<td><input type="text" name ="mw" required></td>
<td>{{wo_no}}</td>
<td><input type="text" name ="mg9" required></td>
<td><input type="text" name ="optno" required></td>
<td><input type="text" name ="prvopt" required></td>
<td><input type="text" name ="remarks" required></td>



</tr>









</table>


<center>
    <input type="submit" name="proceed" value="Save">
</center> 
</div>
{% endif %}
</form>


<script type="text/javaScript">

              document.querySelector("#shop_sec").addEventListener('change',(e)=>{
                      e.preventDefault();
                      var shop_sec = $("#shop_sec").val()
                      var data = {shop_sec};
                        $.ajax({
                          type : 'GET',
                          url : "{% url 'm9getpart_no' %}",
                          dataType : 'json',
                          data : data,
                          success : function(response){
                            if(response == ''){
                               alert("Part no.Not Found for Shop Section:"+shop_sec);
                               window.location='';
                               }
                            var elementsadded = document.querySelectorAll(".newelewono");
                                if(elementsadded.length>0){
                                    var elementsaddedarr = Array.from(elementsadded);
                                    elementsaddedarr.forEach((el)=> el.remove());                                    
                                    document.querySelector("#op_part").selected = true;  
                                    document.querySelector("#op_opno").selected = true;

                                 }
                                var brarr,mystr,html;
                                brarr = response.map((el)=>el.part_no);
                                mystr = "";
                                brarr.forEach((el,index)=>{
                                  html = `<option class="newelewono">${brarr[index]}</option>`
                                  mystr = html.concat(mystr);
                                });
                                html = "";
                                document.querySelector("#part_nop").insertAdjacentHTML('beforeend',mystr);
                                mystr=""; 
                          }
                            })
                  })


$("#part_nop").change(function(e){
    e.preventDefault();
    var part_nop = $("#part_nop").val();
    var shop_sec = $("#shop_sec").val();
    var data = {part_nop,shop_sec};
      $.ajax({
        type : 'GET',
        url : "{% url 'm9getopno' %}",
        dataType : 'json',
        data : data,
        success : function(response){
          if(response == ''){
                               alert("operation NO Not Found for Shop Section:"+shop_sec+",part NO:"+part_no);}
              var elementsadded = document.querySelectorAll(".neweleopn");
              if(elementsadded.length>0){
                var elementsaddedarr = Array.from(elementsadded);
              elementsaddedarr.forEach((el)=> el.remove());
              document.querySelector("#op_opno").selected = true;
             
              
    
              
              }
              var brarr,mystr,html;
              brarr = response.map((el)=>el.opn);
              mystr = "";
              brarr.forEach((el,index)=>{
                html = `<option class="neweleopn">${brarr[index]}</option>`
                mystr = html.concat(mystr);
              });
              html = "";
              document.querySelector("#op_no").insertAdjacentHTML('beforeend',mystr);
              mystr="";
        }
           })
           }) 





$("#op_no").change(function(e){
    e.preventDefault();
    var part_nop = $("#part_nop").val();
    var shop_sec = $("#shop_sec").val();
    var data = {};

      $.ajax({
        type : 'GET',
        url : "{% url 'm9getwono' %}",
        dataType : 'json',
        data : data,
        success : function(response){
          
              var elementsadded = document.querySelectorAll(".newelewo1");
              if(elementsadded.length>0){
                var elementsaddedarr = Array.from(elementsadded);
              elementsaddedarr.forEach((el)=> el.remove());
              document.querySelector("#op_wo").selected = true;
             
              
    
              
              }
              var brarr,mystr,html;
              brarr = response.map((el)=>el.bo_no);
              mystr = "";
              brarr.forEach((el,index)=>{
                html = `<option class="newelewo1">${brarr[index]}</option>`
                mystr = html.concat(mystr);
              });
              html = "";
              document.querySelector("#wo_no").insertAdjacentHTML('beforeend',mystr);
              mystr="";
        }
           })
           }) 









document.querySelector("#wo_no").addEventListener('change',(e)=>{

document.querySelector("#myproceed").click();
})
document.addEventListener('keypress',(event)=>{
if(event.keyCode===13){
    event.preventDefault();


}
})
</script>    


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>


{% endblock content %}
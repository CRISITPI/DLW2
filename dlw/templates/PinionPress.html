{% extends 'base.html' %}
{% block content %}
<html lang="en">
        <head>
            <script>
               $(document).ready(function () {
                    $('#date').datepicker({
                        dateFormat: 'dd-mm-yy'
                    });
                });
            </script>
            <script>
                    $(document).ready(function () {
                         $('#editdate').datepicker({
                             dateFormat: 'dd-mm-yy'
                         });
                     });
                 </script>
                 <script>
                    $(document).ready(function () {
                         $('#inspect_date').datepicker({
                             dateFormat: 'dd-mm-yy'
                         });
                     });
                 </script>
<script>
            $(document).ready(function () {
                $('#dispatch_date').datepicker({
                    dateFormat: 'dd-mm-yy'
                });
            });
        </script>
<script>
    $(document).ready(function () {
            $('#in_qty').datepicker({
                dateFormat: 'dd-mm-yy'
            });
        });
</script> 
<script>
    $(document).ready(function () {
            $('#out_qty').datepicker({
                dateFormat: 'dd-mm-yy'
            });
        });
</script>
<script>
    $(document).ready(function () {
            $('#editin_qty').datepicker({
                dateFormat: 'dd-mm-yy'
            });
        });
</script> 
<script>
    $(document).ready(function () {
        $('#editout_qty').datepicker({
            dateFormat: 'dd-mm-yy'
        });
    });
</script>

        </head>
   
    <style>
        #customers {
            font-family: "Trebuchet MS", Arial, Helvetica, sans-serif;
            border-collapse: collapse;
            margin-left: auto;
            margin-right: auto;
            width: 100%;
        }
        
        #customers td,
        #customers th {
            border: 1px solid #ddd;
            padding: 8px;
        }
    
    </style>
<style>
@import url('https://fonts.googleapis.com/css?family=Quicksand&display=swap');

body {
    font-family: 'Quicksand', sans-serif;
    height:100%;
    margin:0;
}
html{
    height:100%;
    margin:0;
}
.page-content{
    min-height:100%;
    margin-bottom:-40px;
}
.page-content::after{
    content:"";
    display:block;
}
footer, .page-content::after{
    height:40px;
}
.content_section{
    width:60%;
}
</style>

<form action="." id="myForm" method="POST" novalidate>{% csrf_token %}

    <nav class="navbar navbar-expand-md navbar-dark bg-dark">
        <ul class="navbar nav" style="width:60%">
            <font size="4pt" color="#FFFFFF">Pinion Pressing Section</font>
        </ul>

        <div class="collapse navbar-collapse" id="collapse_target">
            <ul class="navbar nav" style="width:100%;">
                <li class="nav-item">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#DeleteModal" style="background: none;font-size: 12pt;margin-Top:2%;margin-left: 2% ">
                            <font color="white">Delete</font>
                     </button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#DispatchModal" style="background: none;font-size: 12pt;margin-Top:2%;margin-left: 2% ">
                            <font color="white">Dispatch</font>
                     </button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#InspectModal" style="background: none;font-size: 12pt;margin-Top:2%;margin-left: 2% ">
                            <font color="white">Inspect</font>
                     </button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#EditModal" style="background: none;font-size: 12pt;margin-Top:2%;margin-left: 2% ">
                            <font color="white">EditRecord</font>
                 </button>
                </li>
                <li class="nav-item">
                    <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#AddModal" style="background: none;font-size: 12pt;margin-Top:2%;margin-left: 2% ">
                    <font color="white">AddRecord</font>
                 </button>
                </li>
            </ul>
        </div>
    </nav>
    <table id="customers">
        <tbody>
            <tr>
                <center>
                    {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                        <font size="3">
                            <li>
                               <h4>{{ message }}</h4>
                            </li>
                        </font>
                        {% endfor %}
                    </ul>
                    {% endif %}
                </center>
            </tr>
            <tr>
                <th>Serial No.&nbsp;</th>
                <th>Batch Order No.&nbsp;</th>
                <th>Part No. &nbsp;</th>
                <th>Batch Qty &nbsp;</th>
                <th>Batch Order Date </th>
                <th>Loco Type &nbsp;</th>
                <th>Date &nbsp; </th>
                <th>In Quantity &nbsp;</th>
                <th>Out Quantity &nbsp;</th>
                <th>Traction Motor No. </th>
                <th>Traction Motor Make </th>
                <th>Axle No.</th>
                <th>Inspection Status</th>
                <th>Inspection Date &nbsp; </th>
            </tr>
        {% for objec in object %}
        <tr>
                <td>{{objec.sno}} <br></td>
                <td>{{objec.bo_no}} <br></td>
                <td>{{objec.pt_no}} <br><br></td>
                <td>{{objec.bo_qty}} <br><br></td>
                <td>{{objec.bo_date}} <br></td>
                <td>{{objec.loco_type}} <br></td>
                <td>{{objec.date}} <br></td>
                <td>{{objec.in_qty}} <br><br></td>
                <td>{{objec.out_qty}} <br><br></td>
                <td>{{objec.tm_no}} <br></td>
                <td>{{objec.tm_make}} <br></td>
                <td>{{objec.axle_no}} <br></td>
                <td>{{objec.dispatch_to}} <br><br></td>
                <td>{{objec.inspect_date}} <br><br></td>
        </tr>
        {% endfor %}
        </tbody>
        </table>     
        <input type="hidden" name="once" id="once" value="0">
    
<!-- Modal -->
<div class="modal fade" id="AddModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">Pinion Pressing</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form method="POST" class="needs-validation" > {% csrf_token %}
      <div class="modal-body">       
                            <div class="row">
                                <div class="col-6">
                                    <label for="">Batch Order No.</label>
                                    <select name="bo_no" id="addbono" class="form-control ll" required>
                                            <option value="" hidden selected>Select BO No.</option>  
                                            {% for x in mybo %}
                                            <option>{{x.bo_no}}</option>
                                            {% endfor %}
                                    </select> 
                                        </div>
                                        <div class="col-6">
                                                <h6><label for="">Batch Order Date</label></h6>
                                                <input type="text" class="form-control" name="bo_date" id="bo_date" placeholder="yyyy-mm-dd" required readonly>
                                        </div>
                                        </div>
                                        <div class="row">
                                        <div class="col-6">
                                            <label>Part No.</label>
                                                <input type="text" class="form-control" name="pt_no" id="pt_no" required readonly>
                                                </div>
                                    <div class="col-6">
                                        <label>Batch Qty</label>
                                        <input type="text" class="form-control" name="bo_qty" id="bo_qty" required readonly>
                                    </div>
                                    </div>
                                    <div class="row">
                                                <div class="col-6">
                                                    <label for="">Machine In Date</label>
                                                    <input type="text" class="form-control" name="in_qty" id="in_qty" placeholder="dd-mm-yyyy" readonly>
                                                </div>
                                                <div class="col-6">
                                                    <label for="">Machine Out Date</label>
                                                    <input type="text" class="form-control" name="out_qty" id="out_qty" placeholder="dd-mm-yyyy" readonly>
                                                </div>
                                            </div>

                                        <div class="row">
                                            <div class="col-6">
                                                <h6><label for="">Loco Type</label></h6>
                                                <input type="text" class="form-control" name="locos" id="locos" placeholder="loco type" required readonly>
                                            </div>
                                       <div class="col-6">
                                            <label for="">Date</label>
                                                <input type="text" name="date" id="date" class="form-control" placeholder="dd-mm-yyyy" required readonly>
                                      </div>
                                   </div>
                                    
                                    <div class="row">   
                                        <div class="col-6">
                                            <label for="">Traction motor No.</label>
                                            <input type="text" class="form-control" name="tm_no" id="tm_no" placeholder="TM no." maxlength="20" required>
                                        </div>   
                                        <div class="col-6">
                                            <label for="">Traction motor Make</label>
                                            <input type="text" class="form-control" name="tm_make" id="tm_make" placeholder="TM make" maxlength="20" required>
                                        </div> 
                                </div>
                                <div class="row">  
                                    <div class="col-6">
                                    <label for="">Axle No.</label>
                                    <select name="axle_no" id="axle_no" class="form-control ll" required>
                                            <option value="" hidden selected>Select BO No.</option>  
                                            {% for x in axleno %}
                                            <option>{{x.axle_no}}</option>
                                            {% endfor %}
                                    </select> 
                                </div> 
                            </div>
                            </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <input type="submit" name="submit" class="btn btn-primary"  id="savebtn" value="Save" />
          </div>
          </form>
        </div>
      </div>
    </div>

<!--EditRecord-->
<!-- Modal -->
<div class="modal fade" id="EditModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel1">Pinion Pressing</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
     
        <form method="POST" class="needs-validation" > {% csrf_token %}
        <div class="modal-body"> 
                            <div class="row">
                                <div class="col-6">
                                    <label for="">S No.</label>
                                    <select name="sno" id="editsno" class="form-control ll" required>
                                        <option value="" hidden selected>Select S No.</option>  
                                        {% for y in mysno %}
                                        <option>{{y.sno}}</option>
                                        {% endfor %}
                                </select> 
                                </div>

                                <div class="col-6">
                                    <h6><label for="">Batch Order No.</label></h6>
                                    <input type="text" class="form-control" name="editbo_no" id="editbo_no" required readonly>
                                </div>
                                        <div class="col-6">
                                            <h6><label for="">Batch Order Date</label></h6>
                                            <input type="text" class="form-control" name="editbo_date" id="editbo_date" required readonly>
                                        </div>

                                            <div class="col-6">
                                                    <h6><label>Part No.</label></h6>
                                                    <input type="text" class="form-control" name="editpt_no" id="editpt_no" required readonly>
                                            </div>
                                            <div class="col-6">
                                                    <h6><label>Batch Qty</label></h6>
                                                    <input type="text" class="form-control" name="editbo_qty" id="editbo_qty" required readonly>
                                            </div>
                                                <div class="col-6">
                                                    <label for="">Machine In Date</label>
                                                    <input type="text" class="form-control" name="editin_qty" id="editin_qty" placeholder="dd-mm-yyyy" readonly>
                                                </div>
                                                <div class="col-6">
                                                    <label for="">Machine Out Date</label>
                                                    <input type="text" class="form-control" name="editout_qty" id="editout_qty" placeholder="dd-mm-yyyy" readonly>
                                                </div>
                                      
                                         <div class="col-6">
                                                <h6><label for="">Loco Type</label></h6>
                                                <input type="text" class="form-control" name="editlocos" id="editlocos" required readonly>
                                            </div>
                                            <div class="col-6">
                                                <label for="">Traction motor No.</label>
                                                <input type="text" class="form-control" id="edittm_no" name="edittm_no" placeholder="" maxlength="20" required>
                                   </div>
                                   <div class="col-6">
                                      <label for="">Date</label>
                                      <input type="text" id="editdate" name="editdate" class="form-control" placeholder="dd-mm-yyyy" required readonly> 
                                   </div>
                                <div class="col-6">
                                    <label for="">Traction motor Make</label>
                                    <input type="text" class="form-control" id="edittm_make" name="edittm_make" placeholder="" maxlength="20" required>
                                </div> 
                                     </div>  
                                    </div>                      
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <input type="submit" name="submit" class="btn btn-primary"  id="editsavebtn" value="Edit" />
          </div>
          </form>
        </div>
      </div>
    </div>

  <!--Dispatch-->
<!-- Modal -->
<div class="modal fade" id="DispatchModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel2" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel2">Pinion Pressing</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <form method="POST" class="needs-validation" > {% csrf_token %}
         <div class="modal-body">       
                                <div class="row">
                                    <div class="col-6">
                                        <label for="">Serial No.</label>
                                        <input type="number" class="form-control" id="dissno" name="dissno" required>
                                    </div>
                                </div>
                                <br>
                                <div class="row">
                                <div class="col-6">
                                        <label for="">Dispatch Date(Manually)</label>
                                        <input type="text" name="dispatch_date" id="dispatch_date" class="form-control" placeholder="dd-mm-yyyy" required readonly>
                                    </div>
                                </div><br>
                                <div class="row">
                               <div class="col-6">
                                <div class="dropdown">
                                  <select name="dislocos" type="form-control ll" required>
                                    <option value="" hidden selected>Dispatch To</option>
                                    <option value="AxleWheel Pressing">Axle & Wheel Pressing Section</option>
                                  </select>
                                  </div>
                                </div>  
                                </div>
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                  <input type="submit" name="submit" class="btn btn-primary"  id="dissavebtn" value="Dispatch" >
                                </div>
                            </form>
                        </div>
                    </div>
                 </div>    

<!--Inspect Wheel-->
<!--modal-->
<div class="modal fade bd-example-modal-lg" id="InspectModal" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Pinion Pressing Inspection</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
            </div>
        
            <form method="POST" class="needs-validation" > {% csrf_token %}

            <div class="modal-body">
                  <div class="row">
                  <div class="col-6">
                          <label for="">Serial No.</label>
                          <select name="snowheel" id="addsno" class="form-control ll" required>
                                  <option value="" hidden selected>Select S.No.</option>  
                                  {% for x in mysno %}
                                  <option>{{x.sno}}</option>
                                  {% endfor %}
                          </select> 
                        </div>         
                    <div class="col-6">
                        <label for="">Pinion No.</label>
                        <input type="text" class="form-control" name="pinion_no" id="pinion_no" placeholder="" maxlength="20" required>
                      </div>
                      <div class="col-6">
                            <label for="">Pinion Make</label>
                            <input type="text" class="form-control" name="pinion_make" id="pinion_make" placeholder="" maxlength="20" required>
                          </div>
                          <div class="col-6">
                                <label for="">Pinion Travel</label>
                                <input type="text" class="form-control" name="pinion_travel" id="pinion_travel" placeholder="" maxlength="20" required>
                              </div>
                              <div class="col-6">
                                    <label for="">Pinion Pressure</label>
                                    <input type="text" class="form-control" id="pinion_pressure" name="pinion_pressure" placeholder="" maxlength="20" required>
                                  </div>
                                  <div class="col-6">
                                        <label for="">Blue matching status</label>
                                        <input type="text" class="form-control" name="blue_match" id="blue_match" placeholder="" maxlength="20" required>
                                      </div>
                                      <div class="col-6">
                                        <label for="">Date(Manually)</label>
                                        <input type="text" name="inspect_date" id="inspect_date" class="form-control" placeholder="dd-mm-yyyy" required readonly>
                                      </div>
                                <!-- <div class="col-6">
                                <label>Loco Type</label>
                                    <input type="text" class="form-control" name="locos" id="locos" required readonly>
                                    </div> -->
                              
                                          
                </div>
            </div>                        

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            <input type="submit" name="submit" class="btn btn-primary" id="savebtn" value="Inspect" />
                        </div>
              </form>
     </div>
 </div>
</div> 

<!--Delete-->
<!-- Modal -->
<div class="modal fade" id="DeleteModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel3" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel3">Pinion Pressing</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
    <form method="POST" class="needs-validation" > {% csrf_token %}
           <div class="modal-body">
                    <div class="row">
                        <div class="col">
                                <label for="">Serial No.</label>
                                <input type="number" class="form-control" id="delsno" name="delsno"  required>
                        </div> 
                    </div>
            </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <input type="submit" name="submit" class="btn btn-primary"  id="delsavebtn" value="Delete">
        </div>
        </form>
    </div>
  </div>
  </div>   
  </form>
  <script>
    $(document).ready(function() {
        $('#delform').bootstrapValidator({
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {
                delsno: {
                    validators: {
                        notEmpty: {
                            message: 'The username is required'
                        }
                    }
                }
            }
        });
    });
    
    $("#addbono").change(function(e){
        e.preventDefault();
        var selbo_no = $(this).val();
        var data = {selbo_no};
          $.ajax({
            type : 'GET',
            url : "{% url 'pinion_addbo' %}",
            dataType : 'json',
            data : data,
            success : function(response){            
                $("#bo_date").val(`${response[0].rel_date}`);
                $("#pt_no").val(`${response[0].part_no}`);
                $("#bo_qty").val(`${response[0].batch_qty}`);
                func1(selbo_no);
            }
        })
    });

    function  func1(batch){
                    var selbo_no = batch;
                    var data = {selbo_no};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'airbox_addloco' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){           
                            $("#locos").val(`${response[0].alpha_1}`);
                        }
                    })
                }



    $("#editsno").change(function(e){
                    e.preventDefault();
                    var sels_no=$(this).val();
                    var data={sels_no};
                        $.ajax({
                            type: 'GET',
                            url: "{% url 'pinion_editsno' %}",
                            dataType: 'json',
                            data:data,
                            success:function(response){
                                console.log(response);
                                $("#editbo_no").val(`${response[0].bo_no}`);
                                $("#editbo_date").val(`${response[0].bo_date}`);
                                $("#editpt_no").val(`${response[0].pt_no}`);
                                $("#editbo_qty").val(`${response[0].bo_qty}`);
                                $("#editdate").val(`${response[0].date}`);
                                $("#edittm_make").val(`${response[0].tm_make}`);
                                $("#edittm_no").val(`${response[0].tm_no}`);
                                $("#editin_qty").val(`${response[0].in_qty}`);
                                $("#editout_qty").val(`${response[0].out_qty}`);
                                var locodes=document.getElementById('editbo_no').value;
                                func2(locodes);
                                
                            }
                        })
                });

                function  func2(batch){
                    var batchNo = batch;
                    var data = {batchNo};
                      $.ajax({
                        type : 'GET',
                        url : "{% url 'airbox_addeditloco' %}",
                        dataType : 'json',
                        data : data,
                        success : function(response){           
                            $("#editlocos").val(`${response[0].alpha_1}`);
                        }
                    })
                }
    
            $("#addsno").change(function(e){
            e.preventDefault();
            var sels_no=$(this).val();
            var data={sels_no};
                $.ajax({
                    type: 'GET',
                    url: "{% url 'FetchPinionInspectDetail' %}",
                    dataType: 'json',
                    data:data,
                    success:function(response){
                        if(response=="false")
                        {
                        document.getElementById('pinion_make').value ='';
                        document.getElementById('pinion_pressure').value ='';
                        document.getElementById('pinion_travel').value ='';
                        document.getElementById('blue_match').value ='';
                        document.getElementById('pinion_no').value ='';
                        }
                        else {
                        $("#pinion_make").val(`${response[0].pinion_make}`);
                        $("#pinion_pressure").val(`${response[0].pinion_pressure}`);
                        $("#pinion_travel").val(`${response[0].pinion_travel}`);
                        $("#blue_match").val(`${response[0].blue_match}`);
                        $("#pinion_no").val(`${response[0].pinion_no}`);
                        }

                    }

                })
            });
    
</script>

</html>  
{% endblock content %}
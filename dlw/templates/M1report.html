{% extends 'base.html' %} 
{% block content %}
<style>
    input[type=text],
    select {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: block;
        border: 0.5px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    th {
  background-color: #f2f2f2;
}
    tr:nth-child(even) {
  background-color: #f2f2f2;
}
    input[type=submit] {
        width: 20%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=submit]:hover {
        background-color: #45a049;
        text-align: center;
    }
    
    input[type=button] {
         width: 20%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=button]:hover {
        background-color: #45a049;
        text-align: center;
    }
</style>
<!-- <h1 align="center" style="background-color: darkslategrey;color:white;padding: 12px;">M1 - MASTER PROCESS SHEET</h1> -->
<form action="{% url 'm1genrept1' %}" method="POST"> {% csrf_token %}
  <div class="container">
            <input type="hidden"  id="h1" name="h1" value="{{part}}">
            <input type="hidden"  id="h2" name="h2" value="{{part}}">
                        
  
                    
                    <center><input type="submit" value="Proceed" name="proceed" id="proceed" style="display: none"/></center>
</div>
<br><br> 
{% if sub == 1 %}
 <div class="container" style="width: 100%">
    <div id="print"  style="align:center" >
  
<br>
<h5 style="float: left"><b>Date: </b>{{dt}}</h5>
<center><h4><u><b>DIESEL LOCOMOTIVE WORKS, VARANASI</b></u></h4></center>
<center><h4><u><b>M1 CARD</b></u></h4></center>
<center><h4><u><b>PROCESS-SHEET</b></u></h4></center>
<br>
{% for i in obj1 %}
<table>
<tr>
<td><h5><b>PART NO:  </b>{{prtno}} </h5></td>
<td><h5><b>&nbsp;&nbsp;&nbsp;&nbsp;DRG-NO.:  </b> {{i.drgno}}</h5></td>
<td><h5><b>&nbsp;&nbsp;&nbsp;&nbsp;RM PART NO:  </b>{{rmpart}}</h5></td>
</tr><tr></tr>
<tr>

<td><h5><b>RM PART DES:  </b>{{rdes}}</h5></td>
<td><h5><b>&nbsp;&nbsp;&nbsp;&nbsp;EPC: </b>{{epcv}}</h5></td>
<td><h5><b>&nbsp;&nbsp;&nbsp;&nbsp;PTC: </b>{{ptcv}}</h5></td>
</tr>
</table>
<table class="table table-stripped">
<tr></tr>
{% endfor %}
</table>
<table>
<div class="table-responsive">
<table class="table table-stripped">
<tr><th rowspan="2">SHOP/SEC</th>
<th rowspan="2">OPR. NO.</th><th rowspan="2">L.C.</th><th rowspan="2">OPERATION DESCRIPTION</th></tr>
        <tr><th  >PA</th><th>AT</th><th>AT(p/pc)</th><th>LOT</th><th>NCP JBS </th><th>M5 CD</th><th>UPDT-DT</th></tr>
        {% for i in dtl %}
        <tr>
            <td>
                {{i.shop_sec}}
            </td>
            <td>
                {{i.opn}}
            </td>
            <input type="hidden" name="opn{{ forloop.counter }}" value="{{i.opn}}">
            <td>
                {{i.lc_no}}
            </td>
            <td>
                {{i.des}}
            </td>
            <td>
                {{i.pa}}
            </td>
            <td>
                {{i.at}}
            </td>
            <td>{{i.at}}</td>
            <td>{{i.lot}}</td>
            <td>
                {{i.ncp_jbs}}
            </td>
            <td>{{i.m5_cd}}</td>
            <td>{{i.updt_dt}}</td>
        </tr>
        {% endfor %}
        <tr>
            <td></td><td></td><td></td>
            <td style="text-align: right"><b>TOTAL TIME(Hrs/Min):</b></td>
            <td><b>{{pttl}}</b></td><td><b>{{attl}}</b></td><td><b>{{attl}}(p/pc)</b></td>
        </tr>
    </table>

<br><br>



</div>

<br>


</div></table>
{% endif %}

<center>
    <input type="button" onclick="printDiv()" value="print">
    <input type="submit" value="Back" name="backbutton"/>
</center>
</form>
<script type="text/javaScript">

window.onload=function()
{
   if(document.getElementById('h2').value.length!='')
        document.querySelector("#proceed").click();
  
    
}
// function clickpr()
// {
//     console.log(document.getElementById('part_nop'));
//     document.getElementById('proceed').click();    
// }
    // document.querySelector("#shop_sec").addEventListener('change',(e)=>{
    //                   e.preventDefault();
    //                   var shop_sec = $("#shop_sec").val()
    //                   var data = {shop_sec};
    //                     $.ajax({
    //                       type : 'GET',
    //                       url : "{% url 'm1getpano' %}",
    //                       dataType : 'json',
    //                       data : data,
    //                       success : function(response){
    //                         var elementsadded = document.querySelectorAll(".newelewono");
    //                             if(elementsadded.length>0){
    //                                 var elementsaddedarr = Array.from(elementsadded);
    //                                 elementsaddedarr.forEach((el)=> el.remove());                                    
    //                                 document.querySelector("#op_part").selected = true;                                   
    //                              }
    //                             var brarr,mystr,html;
    //                             brarr = response.map((el)=>el.part_no);
    //                             mystr = "";
    //                             brarr.forEach((el,index)=>{
    //                               html = `<option class="newelewono">${brarr[index]}</option>`
    //                               mystr = html.concat(mystr);
    //                             });
    //                             html = "";
    //                             document.querySelector("#part_nop").insertAdjacentHTML('beforeend',mystr);
    //                             mystr=""; 
    //                       }
    //                         })
    //               })

function printDiv() {
    var printContents = document.getElementById("print").innerHTML;

      var style = "<style>";
       style = style + "table {width: 100%;font: 17px Calibri;}";
       style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
       style = style + "padding: 2px 3px;text-align: left;}";
       style = style + "</style>";
     var win = window.open('', '', 'height=500,width=500');

       win.document.write('<html><head>');

       win.document.write('<title>M1(INSPECION NOTE) Card</title>');
       win.document.write(style);
       win.document.write('</head>');
       win.document.write('<body>');
       win.document.write(printContents);
       win.document.write('</body></html>');

       win.print();
       win.close();



}
</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
 

{% endblock content %}
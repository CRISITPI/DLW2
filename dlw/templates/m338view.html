{% extends 'base.html' %} 
{% block content %}
<link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>


<style>
  input[type=text],input[type=number],
  select {
      width: 50%;
      padding: 12px 20px;
      margin: 8px 0;
      display: block;
      border: 0.5px solid #ccc;
      border-radius: 4px;
      box-sizing: border-box;
  }
  
  input[type=submit] {
      width: 30%;
      text-align: center;
      background-color: #4CAF50;
      color: white;
      padding: 14px 20px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
  }
  
  input[type=submit]:hover {
      background-color: #45a049;
      text-align: center;
  }
  
  input[type=button] {
      width: 50%;
      text-align: center;
      background-color: #4CAF50;
      color: white;
      padding: 14px 20px;
      margin: 8px 0;
      border: none;
      border-radius: 4px;
      cursor: pointer;
  }
  
  input[type=button]:hover {
      background-color: #45a049;
      text-align: center;
  }
  .button{
    background-color:aqua;
    width: 60px;
  }

</style>

<br>
<h3 align="center">Inter-shop Transfers (M 338)</h3>

<div> <h6 align="left" style="margin-left: 100px;">आई.एस.ओ. - 9002/ I.S.O. - 9002 </h6> </div>
<div> <h6 align="left" style="margin-left: 100px;">डी० रे० का (वाराणासी )/ D.L.W. (Varanasi)</h6> <h6 align="right" style="margin-right: 100px;">एम. -338/ M 338 </h6></div><br>

<br><br>
<form action="{% url 'm338view' %}" method="POST"> 
    {% csrf_token %}
    <div class="container">
        <table class="table" width = 100%>
            <td>
                <label for="sno"><b>From Shop Section No./शॉप अधी. से:</b></label></br></br>
                        <select class="form-control" id="shop_sec" name="shop_sec" required>
                                    <option id="op_shop" selected disabled hidden>Select Shop Section</option>
                                {% if lenm == 1 %}
                                    <option selected readonly>{% for role in roles %}{{role}}{% endfor %}</option>
                                {% endif %}
                                {% if lenm > 1 %}
                                {% for role in roles %}
                                <option>{{role}}</option>
                                {% endfor %}
                                {% endif %}                         
                        </select>
                    </td>
                    <td>
                        <label for="staff_no"><b>Employee No./
                            कर्मचारी संख्या:</b></label></br>
                        
                        <select class="form-control" id="staffNo" name="staffNo" required>
                                  <option id="op_staffNo" selected disabled hidden>Select Staff NO</option>
                                  {% if lenm == 1 %}
                                  {% for i in wo_nop %}
                                    <option>{{i.staff_no}}</option>
                                  {% endfor %}
                                  {% endif %}
                         </select>
                    </td>                          
                
                     <td>
                        <label for="staff_no"><b>Employee Name./कर्मचारी नाम:</b></label> </br></br>                 
                        <select class="form-control" id="staffName" name="staffName" required>
                                  <option id="op_staffName" selected disabled hidden>Select Staff Name</option>
                                  {% if lenm == 1 %}
                                  {% for i in wo_nop %}
                                    <option>{{i.name}}</option>
                                  {% endfor %}
                                  {% endif %}
                         </select>
                    </td>
                    <td>
                        <label for="staff_no"><b>Designation/पद:</b></label></br></br></br>
                        <select class="form-control" id="staffDesg" name="staffDesg" required>
                                  <option id="op_staffDesg" selected disabled hidden>Select Designation</option>
                                  {% if lenm == 1 %}
                                  {% for i in wo_nop %}
                                    <option>{{i.desgn}}</option>
                                  {% endfor %}
                                  {% endif %}
                         </select>
                    </td>
                    <td>
                        <label for="staff_no"><b>Rate of Pay/
                            वेतन की दर:</b></label></br></br>
                            <!--<input type="text" class="form-control" name="staffRate" id="staffRate" >-->
                            <select class="form-control" name="staffRate" id="staffRate" required>
                                <option id="op_staffrate" selected disabled hidden>Rate of pay</option>
                                {% if lenm == 1 %}
                                {% for i in wo_nop %}
                                  <option>{{i.desgn}}</option>
                                {% endfor %}
                                {% endif %}
                       </select>
                       
                        </td>
        <td>
            <td>
                <label for="sno"><b>Date of Transfer/ 
                    स्थानांतरण की तारीख:</b></label>
                <input type="text" name="date1" id="date1" readonly class="form-control" required>
            </td>
        </td>
        <td>
            <label for="staff_no"><b>Reference to the Authority for transfer/हस्तांतरण के अधिकार का संदर्भ:</b></label></br></br>
            <input type="text" id="reference_authority" name="reference_authority">
        </td>
        <td>
            <label for="staff_no"><b>To Shop Section No./
                शॉप अधी. में:</b></label></br></br>
                <select class="form-control" id="toshop_sec" name="toshop_sec" required>
                    <option id="op_shop" selected disabled hidden>Select Shop Section</option>
                {% if lenm == 1 %}
                    <option selected readonly>{% for role in roles %}{{role}}{% endfor %}</option>
                {% endif %}
                {% if lenm > 1 %}
                {% for role in roles %}
                <option>{{role}}</option>
                {% endfor %}
                {% endif %}                         
        </select>
        </td>
    </tr>   
  </table>
    <br>   

    <input type="Submit" value="draft" name="draft" id="draft" />
    <input type="Submit" value="final" name="final" id="final" />
    <input type="Submit" value="viewdraft" name="viewdraft" id="viewdraft" />
    </div>
    

     <div>
      <table border="1" align="center" id = "table">
          <thead>
            <th>Shop_sec</th>
            <th>Emp No</th>
            <th>Emp Name</th>
            <th>Designation</th>
            <th>Reference authority</th>
            <th>Staff rate</th>
            <th>Toshop_sec</th>
            <th>Transfer_date</th>
            <th>Select_status</th>
              
          </thead>
          <tbody>
              {% for i in obj %}
              <tr>
                
                <td><input type="text" name="shop_sec" id="shop_sec" value="{{i.shop_sec}}"></td>
                <td><input type="text" name="staffNo" id="staffNo" value="{{i.staffNo}}"></td>
                <td><input type="text" name="staffName" id="staffName" value="{{i.staffName}}"></td>
                <td><input type="text" name="staffDesg" id="staffDesg" value="{{i.staffDesg}}"></td>
                <td><input type="text" name="reference_authority" id="reference_authority" value="{{i.reference_authority}}"></td>
                <td><input type="text" name="staffRate" id="staffRate" value="{{i.staffRate}}"></td>
                <td><input type="text" name="toshop_sec" id="toshop_sec" value="{{i.toshop_sec}}"></td>
                <td><input type="text" name="date1" id="date1" value="{{i.date1}}"></td>
                <td><input  type = "submit" class = sub value = "{{i.staffNo}}"  name = "{{i.staffNo}}"  id = "{{i.staffNo}}"></td>
              </tr>
              {% endfor %}
          </tbody>
          
      </table> 
  </div>
</div>
<br>
</div>  
</form>
<script> 
// $('status_final').click(function(){
//   $(document).ready(function(){
//   window.alret("hi")
//   var id = document.getElementById("i.staffNo").value;
//   var data = {id};
//   $.ajax({
//     type: 'GET',
//     url: "{% url 'edit_status' %}",
//     dataType : 'json',
//     data :data,
//   });
//   });
// }) ;
// 
//     window.alert(requested_to);
//     $(i.staffNo).click(function(){
//       window.alert(requested_to);
//       document.write(requested_to);
//       var requested_to = document.getElementById('i.staffNo').value;
//       print(requested_to);
//       window.alert(requested_to);
//       $.ajax({
//         type : 'GET',
//         url : "{% url 'edit_status' %}",
//         data = {requested_to},
//         dataType : 'json',
        
//         success: function(response){
//          console.log(data);
//         },
//       });
//     });
$('.sub').click(function(e){
  e.preventDefault();
  var id1 = document.getElementById(this.id).value;
  
  var data = {id1};
  
  $.ajax({
        type : 'GET',
        url : "{% url 'edit_status' %}",
        data : data,
        dataType : 'json',
        
      
  })
 });


  document.querySelector("#shop_sec").addEventListener('change',(e)=>{
                     e.preventDefault();
                     var shop_sec = $("#shop_sec").val();
                     var date = $("#date").val();
                     var data = {date,shop_sec};
                       $.ajax({
                         type : 'GET',
                         url : "{% url 'm27getStaffNo' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           var elementsadded = document.querySelectorAll(".newelepart1");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());       
                                   document.querySelector("#op_staffNo").selected=true;      
                                   document.querySelector("#op_staffName").selected=true;   
                                   document.querySelector("#op_staffDesg").selected=true;   
                                   document.querySelector("#op_staffrate").selected=true;  
                                   document.querySelector("#op_date2").selected=true; 
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.staff_no); 
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart1">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#staffNo").insertAdjacentHTML('beforeend',mystr);
                               mystr=""; 
                         }
                    })
                 })
 
 
     document.querySelector("#staffNo").addEventListener('change',(e)=>{
                     e.preventDefault();
                     var shop_sec = $("#shop_sec").val();
                     var staffNo = $("#staffNo").val();
                     var data = {shop_sec,staffNo};
                       $.ajax({
                         type : 'GET',
                         url : "{% url 'm27getDetails' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           var elementsadded = document.querySelectorAll(".newelepart2");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());       
                                   document.querySelector("#op_staffName").selected=true;    
                                   document.querySelector("#op_staffDesg").selected=true;   
                                   document.querySelector("#op_staffrate").selected=true;  
                                   document.querySelector("#op_date2").selected=true;                                  
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.name);
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart2">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#staffName").insertAdjacentHTML('beforeend',mystr);
                               mystr="";                              
                         }
                    })
                 })
 
                 document.querySelector("#staffName").addEventListener('change',(e)=>{
                     e.preventDefault();
                     var staffName = $("#staffName").val();
                     var staffNo = $("#staffNo").val();
                     var data = {staffName,staffNo};
                       $.ajax({
                         type : 'GET',
                         url : "{% url 'm27getDesignation' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           var elementsadded = document.querySelectorAll(".newelepart3");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());       
                                   document.querySelector("#op_staffDesg").selected=true;  
                                   document.querySelector("#op_staffrate").selected=true;   
                                   document.querySelector("#op_date2").selected=true;                                    
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.desgn);
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart3">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#staffDesg").insertAdjacentHTML('beforeend',mystr);
                               mystr="";                              
                         }
                    })
                 })
 
               document.querySelector("#staffDesg").addEventListener('change',(e)=>{
                     e.preventDefault();
                     var shop_sec = $("#shop_sec").val();
                     var data = {shop_sec};
                       $.ajax({
                         type : 'GET',
                         url : "{% url 'm27getWorkOrder' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           var elementsadded = document.querySelectorAll(".newelepart4");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());         
                                   document.querySelector("#op_wono").selected=true;
                                   document.querySelector("#op_date2").selected=true;                                                                      
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.batch_no);
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart4">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#staffRate").insertAdjacentHTML('beforeend',mystr);
                               mystr="";                              
                         }
                    });
                 })
 
                 document.querySelector("#toshop_sec").addEventListener('change',(e)=>{
                     e.preventDefault();
                     var toshop_sec = $("#toshop_sec").val();
                     var data = {toshop_sec};
                       $.ajax({
                         type : 'GET',
                         url : "{% url 'm27getDetails' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           var elementsadded = document.querySelectorAll(".newelepart5");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());         
                                   document.querySelector("#op_date2").selected=true;                                                                     
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.date);
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart5">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#date2").insertAdjacentHTML('beforeend',mystr);
                               mystr="";                              
                         }
                    })
                 })
                 document.querySelector("#reference_authority").addEventListener('change',(e)=>{
                     e.preventDefault();
                     var reference_authority = $("#reference_authority").val();
                     var data = {reference_authority};
                       $.ajax({
                         type : 'GET',
                         url : "{% url 'm338authority' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           var elementsadded = document.querySelectorAll(".newelepart6");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());         
                                   document.querySelector("#op_date2").selected=true;                                                                     
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.date);
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart6">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#date2").insertAdjacentHTML('beforeend',mystr);
                               mystr="";                              
                         }
                    });
                 });
 
 
 </script>
 
 
 <script>
    
  
      $(document).ready(function () {
         $('#date1').datepicker({ dateFormat: 'dd-mm-yy', }); 
    });
     
    $(document).ready(function () {
         $('#date2').datepicker({ dateFormat: 'yy-mm-dd', }); 
    });
     
     $( document ).ready(function() {    
     var totindb=document.getElementById('totindb').value; 
     });
 
   var j=0;
  
   $("#add").click(function(e) {
     event.preventDefault()
         console.log("j"+String(j));
         j++;           
  
         var nameoname="wono"+String(j);
         var date2="date2"+String(j);
         var date3="date3"+String(j);
         var totindb="totindb"+String(j);        
         console.log(wono+" : "+date2+" : "+date3+" : "+totindb);
 
         var totindb=document.getElementById('totindb').value; 
         document.getElementById("totmebs").value=j;
         
         var htAppend='<div><table id="customers"><tr>'+
                           '<td><select name='+nameoname+' id='+nameoname+' onchange="find(this);" class="form-control ll" style="width: 220px;" required ><option  value="" disabled hidden>Select WO Number</option></select></td>'+          
                           '<td><input type="text" id="'+date2+'"   name="'+date2+'" readonly ></td>'+
                           '<td><input type="date" id="'+date3+'"   name="'+date3+'" ></td>'+
                           '<td><input type="text" id="'+totindb+'" name="'+totindb+'" ></td>';
  
      htAppend=htAppend+'</tr></table>'+'</div>';
      $('#items').append(htAppend);  
      var shop_sec = $("#shop_sec").val();
      var data = {shop_sec};
       $.ajax({
                         type : 'GET',
                         url : "{% url 'm27getWorkOrder' %}",
                         dataType : 'json',
                         data : data,
                         success : function(response){
                           console.log("in add ajax");
                           console.log(response);
                           var elementsadded = document.querySelectorAll(".newelepart6");
                               if(elementsadded.length>0){
                                   var elementsaddedarr = Array.from(elementsadded);
                                   elementsaddedarr.forEach((el)=> el.remove());         
                                   document.querySelector("#op_wono").selected=true;
                                   document.querySelector("#op_date2").selected=true;                                                                    
                                }
                               var brarr,mystr,html;
                               brarr = response.map((el)=>el.batch_no);
                               mystr = "";
                               brarr.forEach((el,index)=>{
                                 html = `<option class="newelepart6">${brarr[index]}</option>`
                                 mystr = html.concat(mystr);
                               });
                               html = "";
                               document.querySelector("#"+nameoname).insertAdjacentHTML('beforeend',mystr);
                               mystr="";                              
                         }
                    });
 
     
      var x=document.getElementById("batch_no");
      var pp=0;
      for (pp = 0; pp < x.options.length; pp++) {
       
      $("#"+nameoname).append("<option value='"+x.options[pp].value+"'>"+x.options[pp].value+"</option>");
      }

  var data = {shop_sec,staffNo,staffName,staffDesg,reference_authority,staffRate,toshop_sec,date1};
  
        $.ajax({
              type : 'GET',
              url : "{% url 'm338view' %}",
              dataType : 'json',
              data : data,
              success : function(response){
                        var elementsadded = document.querySelectorAll(".neweledoc");
                            if(elementsadded.length>0){
                                var elementsaddedarr = Array.from(elementsadded);
                                elementsaddedarr.forEach((el)=> el.remove());
                                document.querySelector("#op_doc").selected = true;
                             }
                            var brarr,mystr,html;
                            brarr = response.map((el)=>el.doc_no);
                            mystr = "";
                            brarr.forEach((el,index)=>{
                              html = `<option class="neweledoc">${brarr[index]}</option>`
                              mystr = html.concat(mystr);
                            });
                            html = "";
                            document.querySelector("#doc_no").insertAdjacentHTML('beforeend',mystr);
                            mystr="";
                      }
                        })
              })

 </script>
{% endblock content %}

{% extends 'base.html' %}
 {% block content %} 
 
 {% load static %}
 
<!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/css/select2.min.css" rel="stylesheet" /> -->
 
 

<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.10/js/select2.min.js"></script>

<!-- {% comment %} <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> {% endcomment %}
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

{% comment %} <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> {% endcomment %} -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
 
<script>
    $(document).ready(function () { $('#month').datepicker({dateFormat: 'mm-yy'}); });
</script>

<style>
    input[type=text],
    select {
        width: 100%;
        padding: 12px 20px;
        margin: 8px 0;
        display: block;
        border: 0.5px solid #ccc;
        border-radius: 4px;
        box-sizing: border-box;
    }
    
    input[type=submit] {
        width: 20%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 14px 20px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=submit]:hover {
        background-color: #45a049;
        text-align: center;
    }
    
    input[type=button] {
        width: 10%;
        text-align: center;
        background-color: #4CAF50;
        color: white;
        padding: 6px 6px;
        margin: 8px 0;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }
    
    input[type=button]:hover {
        background-color: #45a049;
        text-align: center;
    }
</style>


<br>
<h3 align="center">M13 Card <br>Monthly Position Register</h3>
<br>


<form action="{% url 'M13register' %}" method="POST"> {% csrf_token %}
        <div class="container">
                <table class="table">
                    <tr>
                        <td>
                            <label for="sno"><b>SHOP SECTION NO/शॉप अधी. :</b></label>
                          
        
                            <select class="form-control" id="shop_sec" name="shop_sec" required>
                                <option id="op_shop" selected disabled hidden>Select Shop Section</option>
                                    {% if lenm == 1 %}
                                        <option selected readonly>{% for role in roles %}{{role}}{% endfor %}</option>
                                        {{role}}
                                    {% endif %}
                                    {% if lenm > 1 %}
                                        {% for role in roles %}
                                        {{role}}
                                        <option>{{role}}</option>
                                    {% endfor %}
                                    {% endif %}
                            </select>
                        </td> 
                        <td>
                            <label for="sno"><b>Month</b></label>            
                            <input type="text" class="form-control ll" id="month" name="month" required readonly/>
                        </td>
                    </tr>
            {% if sub == 1 %}
            </table>
            <table border="1" align="center">
                <thead>
                    <th>S. No</th>
                    <th>M-13 No.</th>
                    <th>Date</th>
                    <th>SEG</th>
                    <th>Work Order</th>
                    <th>Job Sr No.</th>
                    <th>Part No.</th>
                    <th>Quantity</th>
                    <th>NCR</th>
                    <th>Faulty By</th>
                    <th>Staff No.</th>
                    <th>Chargeable Work Order</th>
                    <th>Operation No</th>
                    <th>Reason For Rejection</th>
                    
                </thead>
                <tbody>
                    {% for i in obj %}
                    <tr>
                        <td>{{i.slno}}</td>
                        <td>{{i.m13_no}}</td>
                        <td>{{i.m13_date}}</td>
                        <td>{{seg}}</td>
                        <td>{{i.wo}}</td>
                        <td>{{JBSR}}</td>
                        <td>{{i.part_no}}</td>
                        <td>{{i.qty_tot}}</td>
                        <td>{{ncr}}</td>
                        <td>{{i.fault_cd}}</td>
                        <td>{{i.staff_no}}</td>
                        <td>{{i.wo_rep}}</td>
                        <td>{{i.opn}}</td>
                        <td>{{i.reason}}</td>
                        <td>{{i.wo_rep}}</td>
                       
                    </tr>
                    {%endfor%}
                </tbody>
            </table>
            <table style="width:100%;">            
                    <tr>                                          
                        <td align="left">
                            <br><br>{{name}}
                            ______________<br>
                            Received By
                        </td>
                    </tr>
            </table>
            {% endif %}
    </div>
</form>

<script type="text/javaScript">
    document.querySelector("#shop_sec").addEventListener('change',(e)=>{
                      e.preventDefault();
                      var shop_sec = $("#shop_sec").val()
                      var data = {shop_sec};
                        $.ajax({
                          type : 'GET',
                          url : "{% url 'm13registergetwono' %}",
                          dataType : 'json',
                          data : data,
                          success : function(response){
                            var elementsadded = document.querySelectorAll(".newelewono");
                                if(elementsadded.length>0){
                                    var elementsaddedarr = Array.from(elementsadded);
                                    elementsaddedarr.forEach((el)=> el.remove());
                                    document.querySelector("#op_wo").selected=true;
                                    document.querySelector("#op_m13no").selected = true;
                                    document.querySelector("#op_part").selected = true;
                                    
                                     
                                 }
                                var brarr,mystr,html;
                                brarr = response.map((el)=>el.wo);
                                mystr = "";
                                brarr.forEach((el,index)=>{
                                  html = `<option class="newelewono">${brarr[index]}</option>`
                                  mystr = html.concat(mystr);
                                });
                                html = "";
                                document.querySelector("#wno").insertAdjacentHTML('beforeend',mystr);
                                mystr=""; 
                          }
                            })
                  })
    
    $("#wno").change(function(e){
        e.preventDefault();
        var wo_no = $(this).val();
        var shop_sec = $("#shop_sec").val();
        var data = {wo_no,shop_sec};
          $.ajax({
            type : 'GET',
            url : "{% url 'm13registergetpano' %}",
            dataType : 'json',
            data : data,
            success : function(response){
                  var elementsadded = document.querySelectorAll(".newelepart");
                  if(elementsadded.length>0){
                    var elementsaddedarr = Array.from(elementsadded);
                  elementsaddedarr.forEach((el)=> el.remove());
                  
                  document.querySelector("#op_m13no").selected = true;
                  document.querySelector("#op_part").selected = true;
                  
                  
                  }
                  var brarr,mystr,html;
                  brarr = response.map((el)=>el.part_no);
                  mystr = "";
                  brarr.forEach((el,index)=>{
                    html = `<option class="newelepart">${brarr[index]}</option>`
                    mystr = html.concat(mystr);
                  });
                  html = "";
                  document.querySelector("#part_nop").insertAdjacentHTML('beforeend',mystr);
                  mystr="";
            }
               })
               }) 
    
    
    
    
    $("#part_nop").change(function(e){
        e.preventDefault();
        var wo_no = $("#wno").val();
        var shop_sec = $("#shop_sec").val();
        var part_nop = $("#part_nop").val();
        var data = {wo_no,shop_sec,part_nop};
          $.ajax({
            type : 'GET',
            url : "{% url 'm13registergetno' %}",
            dataType : 'json',
            data : data,
            success : function(response){
                  var elementsadded = document.querySelectorAll(".newelem13no");
                  if(elementsadded.length>0){
                    var elementsaddedarr = Array.from(elementsadded);
                  elementsaddedarr.forEach((el)=> el.remove());
                  
                  document.querySelector("#op_m13no").selected = true;
                  
                  
                  }
                  var brarr,mystr,html;
                  brarr = response.map((el)=>el.m13_no);
                  mystr = "";
                  brarr.forEach((el,index)=>{
                    html = `<option class="newelem13no">${brarr[index]}</option>`
                    mystr = html.concat(mystr);
                  });
                  html = "";
                  document.querySelector("#m13_no").insertAdjacentHTML('beforeend',mystr);
                  mystr="";
            }
               })
               }) 
    
    
    
    document.querySelector("#m13_no").addEventListener('change',(e)=>{
    
    document.querySelector("#myproceed").click();
    })
    document.addEventListener('keypress',(event)=>{
    if(event.keyCode===13){
        event.preventDefault();
    }
    })
        $(document).ready(function () {
            $('#updt_date').datepicker({
                dateFormat: 'dd-mm-yy',
                onSelect: function(  ){
            document.querySelector("#myproceed").click();
            }
        });

        
});
    function printDiv() {
        var printContents = document.getElementById("print").innerHTML;
    
            var style = "<style>";
            style = style + "table {width: 100%;font: 17px Calibri;}";
            //style = style + "table, th, td {border: solid 1px #DDD; border-collapse: collapse;";
            style = style + "padding: 2px 3px;text-align: left;}";
            style = style + "</style>";
            var win = window.open('', '', 'height=500,width=500');
    
            win.document.write('<html><head>');
    
            win.document.write('<title>MG33 Report</title>');
            win.document.write(style);
            win.document.write('</head>');
            win.document.write('<body>');
            win.document.write(printContents);
            win.document.write('</body></html>');
    
            win.print();
            win.close();

    }       
</script>

{% endblock content %}